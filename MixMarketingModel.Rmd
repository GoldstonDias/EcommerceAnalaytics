---
title: "Data PreProcessing"
author: "Goldston Dias"
date: "March 4, 2019"
output: rmarkdown::github_document
---
## Install and load packages neccesary  for analysis
```{r message=FALSE, warning=FALSE}
library(dplyr)
library(plyr)
library(lubridate)
library(MASS)
library(car)
library(DataCombine)
library(zoo)
library(glmnet)
library(DAAG)
library(ggplot2)
```

## Load Dataset in working directory 
```{r message=FALSE, warning=FALSE}
ecom <- read.csv("mmm_data.csv")
```
# Let's modify the name 
```{r message=FALSE, warning=FALSE}
colnames(ecom) <- c("FSN_ID","Order_date","Year","Month","Order_id","Order_item_id","gmv","Units","deliverybdays","deliverycdays", "payment_mode","SLA","cust_id","pincode","P_super_category","P_analytic_category","P_sub_category","P_analytic_vertical","MRP","Procurement_SLA")
```
### structure of dataset 
```{r message=FALSE, warning=FALSE}
str(ecom)
summary(ecom)
```
### Data sanity Check : Data should be from july-2015 to June -2016,Let's remove other data from ecom dataset
```{r message=FALSE, warning=FALSE}
ecom <- subset(ecom, !(Month ==5 & Year==2015|Month ==6 & Year==2015|Month ==7 & Year==2016))
```
## Convert the dataset into weekly levels. 
```{r message=FALSE, warning=FALSE}
# Lubridate package 
library(lubridate)
ecom$Order_date <- date(ecom$Order_date)

# create new column week of year 
ecom$week_year <- week(ecom$Order_date)

# Data quality issues 
# Jan 2016 should be week 54, not week 1 etc. 
ecom$week_year<- ifelse(ecom$week_year<=26 & ecom$Year==2016,ecom$week_year+53,ecom$week_year)

# create new column of date 
ecom$date<-as.Date(ecom$Order_date)

summary(ecom$MRP)
```

### Let us not consider free products and remove missing values
```{r message=FALSE, warning=FALSE}
ecom <- subset(ecom,MRP!=0)
sum(is.na(ecom))

# removing rows with NA values
ecom <- na.omit(ecom)
ecom$gmv[which(ecom$gmv==0)] <- 1
```

### GMV should not be more than MRP*units since we can offer discounts but not charge higher
```{r message=FALSE, warning=FALSE}
ecom <- subset(ecom, (MRP*Units)>=gmv)
```
### Let's divide the dataset into 3 dataframes based on category.
```{r message=FALSE, warning=FALSE}
GamingAccessory <-ecom[ecom$P_sub_category=="GamingAccessory" ,] 

CameraAccessory<-ecom[ecom$P_sub_category=="CameraAccessory",]

HomeAudio<-ecom[ecom$P_sub_category=="HomeAudio",]
```


### KPI FUNCTION FOR ALL THE 3 above categories

```{r message=FALSE, warning=FALSE}
Product_data <- function(dataset){
  
  #1. KPI - List price for all the products
  dataset$list_price <- dataset$gmv/dataset$Units
  
  #2. KP - Promotional Offer for all the products
  dataset$promotional_offer <- (dataset$MRP-dataset$list_price)/dataset$MRP

  
  #3. Clustering
  ## Creating a new KPI (though not used in the final model)
  ## It divides the products into three categories based on MRP and num units sold - 
  ## mass market, medium market and premium product
  
  dataset$P_analytic_vertical <- factor(dataset$P_analytic_vertical)
  
  cluster<- aggregate(cbind(Units,list_price,MRP)~P_analytic_vertical,dataset,mean)
  
  
  if(nrow(cluster)<=3){
    
    cluster$p_tag <-NA
    # Assuming premium product:- 
    
    cluster$P_tag[which(cluster$MRP>=mean(cluster$MRP))] <- "Middle_p"
    cluster$P_tag[-which(cluster$MRP>=mean(cluster$MRP))] <- "Mass_p"
    
    cluster <- cluster[,-c(2:4)]
    
    dataset <-merge(dataset,cluster,by="P_analytic_vertical")
    
  } else {
    
    #str(cluster) 
    
    cluster$list_price_1 <- scale(cluster$list_price)
    cluster$MRP_1<- scale(cluster$MRP)
    cluster$Units_1 <- scale(cluster$Units)
    
    #str(cluster)
    
    k1 <- cluster[,-c(2:4)]
    
    clust <- kmeans(k1[,-1], centers = 3,iter.max = 50,nstart = 50)
    
    cluster$P_tag <- as.factor(clust$cluster)
    
    cluster <- cluster[,c(1,8)]
    
    # Add extra column in dataset with 
    dataset <-merge(dataset,cluster,by=c("P_analytic_vertical"),all.x=TRUE)
    
    
    library("plyr")
    library("dplyr")
    
    k2 <- table(dataset$P_tag)
    
    levels(dataset$P_tag)[which(k2==max(table(dataset$P_tag)))] <- "Mass_p"
    levels(dataset$P_tag)[which(k2==min(table(dataset$P_tag)))] <- "Premium_p"
    levels(dataset$P_tag)[which(k2!=max(table(dataset$P_tag))& k2!=min(table(dataset$P_tag)))] <- "Middle_p"
    
    
  }
  
  
  #3. Payment model indicator
  dataset$order_pay_ind<-ifelse(dataset$payment_mode=="Prepaid",1,0)
  
  #4.Add (Online_order/Total Order) KPI
  
  # Total Order placed
  total_order <-aggregate(order_pay_ind ~ week_year,data=dataset,FUN=NROW)
  
  # Total online order
  Online_order<-aggregate(order_pay_ind ~ week_year,data=dataset,FUN=sum)
  
  # Merge the both the file 
  merged <-merge(total_order,Online_order,by=c("week_year"),all.x=TRUE)
  
  # Create new column of percentage online
  merged$per_order <- merged$order_pay_ind.y/merged$order_pay_ind.x
  
  # Remove other variables from 
  # Merge with dataset file. 
  merged <- merged[,-c(2,3)]
  
  # add "per_order" column in dataset 
  
  dataset<- merge(dataset,merged,by=c("week_year"),all.x=TRUE)
  
  dataset$P_sub_category <- NULL
  
  dataset$P_super_category <- NULL
  
  dataset$P_analytic_category <- NULL
  
  
  #6.NPS score
  nps<-read.csv("nps.csv",h=T)
  nps$Month<-as.character(nps$Month)
  
  
  dataset<-merge(dataset,nps,by=c("Month","Year"),all.x=TRUE)
  
  #5.Holiday_column
  holiday_list<-c("2015-07-18","2015-07-19","2015-08-15",
                  "2015-08-16","2015-08-17","2015-08-28",
                  "2015-08-29","2015-08-30","2015-10-15",
                  "2015-10-16","2015-10-17","2015-11-07","2015-11-08","2015-11-09","2015-11-10",
                  "2015-10-11","2015-10-12","2015-11-13","2015-11-14","2015-12-25","2015-12-26",
                  "2015-12-27","2015-12-28","2015-12-29","2015-12-30","2016-01-01","2016-01-02",
                  "2016-01-03","2016-01-20","2016-01-21","2016-01-22","2016-02-01","2016-02-02",
                  "2016-02-20","2016-02-21","2016-02-14","2016-02-15","2016-03-07","2016-03-08",
                  "2016-03-09","2016-05-25","2016-05-26","2016-05-27")
  
  
  holiday_list <- as.Date(holiday_list)
  
  week_year <- week(holiday_list)
  
  year <- year(holiday_list)
  
  holiday <- data.frame(week_year,year)
  
  holiday$week_year<- ifelse(holiday$week_year<=26 & holiday$year==2016,holiday$week_year+53,holiday$week_year)
  
  holiday$year <-NULL
  holiday$holiday_freq <- 1
  
  holiday <- aggregate( holiday_freq ~ week_year,holiday,sum)
  
  
  products <- as.data.frame.matrix(t(table(dataset$P_tag,dataset$week_year)))
  
  
  products$week_year <- row.names(products)
  
  dataset_1 <- aggregate(gmv~week_year,dataset,sum)
  
  dataset<- aggregate(cbind(list_price,MRP,Units,SLA,promotional_offer,Procurement_SLA,per_order,NPS)~ week_year,data=dataset,FUN = mean)
  
  
  dataset <- merge(dataset,products,by="week_year",all.x=TRUE)
  
  dataset <- merge(dataset,holiday,by="week_year",all.x=TRUE)
  
  dataset$holiday_freq[is.na(dataset$holiday_freq)] <-0
  
  dataset <- merge(dataset,dataset_1,by="week_year",all.x=TRUE)
  
  return(dataset) 
  
} 
```

### Summarizing the datasets again
```{r message=FALSE, warning=FALSE}
# Datasets

GamingAccessory<- Product_data(GamingAccessory)

HomeAudio <-Product_data(HomeAudio)

CameraAccessory <- Product_data(CameraAccessory)

```
### Create Adstock manually for each of the variables and import it
```{r message=FALSE, warning=FALSE}
Adstock <- read.csv("Final_adstock.csv")
```


### Combine the Weekly KPI in the dataset 

### Final process for Gaming Accessory
```{r message=FALSE, warning=FALSE}
GamingAccessory <- merge(GamingAccessory , Adstock,by.x = "week_year")

```

## Final process for HomeAudio
```{r message=FALSE, warning=FALSE}
HomeAudio <- merge(HomeAudio,Adstock,by.x = "week_year")

##################################################################################################
```
### Final process for Camera ccessory
```{r message=FALSE, warning=FALSE}
CameraAccessory <- merge(CameraAccessory,Adstock,by.x = "week_year")


```
### Creating moving average variables
```{r message=FALSE, warning=FALSE}
advanced_kpi <- function(dataset)
{
  library(dplyr)
  library(zoo)
  
  myfun1 = function(x) rollmean(x, k = 2, fill = NA, align = "right")
  myfun2 = function(x) rollmean(x, k = 3, fill = NA, align = "right")
  myfun3 = function(x) rollmean(x, k = 4, fill = NA, align = "right")
  
  #dataset1<-arrange(dataset1,P_analytic_vertical,Year,week_year)
  
  x=dataset[,c("week_year","list_price","promotional_offer")]
  
  
  x1<-x %>% mutate_each(funs(myfun1),list_price,promotional_offer) %>% data.frame()
  
  x2<-x %>% mutate_each(funs(myfun2),list_price,promotional_offer) %>% data.frame()
  
  x3<-x %>% mutate_each(funs(myfun3),list_price,promotional_offer) %>% data.frame()
  
  
  x1$LP_MA1<-(x1$list_price)
  x1$PO_MA1<-(x1$promotional_offer)
  
  x2$LP_MA2<-(x2$list_price)
  x2$PO_MA2<-(x2$promotional_offer)
  
  x3$LP_MA3<-(x3$list_price)
  x3$PO_MA3<-(x3$promotional_offer)
  
  x4=cbind(x1[,-c(2:3)],x2[,-c(1:3)],x3[,-c(1:3)])
  
  
  
  dataset<-merge(dataset,x4,by="week_year")
  
  
  
  dataset$inc_LP_MA1<-(dataset$list_price - dataset$LP_MA1)/dataset$LP_MA1
  dataset$inc_LP_MA2<-(dataset$list_price - dataset$LP_MA2)/dataset$LP_MA2
  dataset$inc_LP_MA3<-(dataset$list_price - dataset$LP_MA3)/dataset$LP_MA3
  
  dataset$inc_PO_MA1<-(dataset$promotional_offer - dataset$PO_MA1)/dataset$PO_MA1
  dataset$inc_PO_MA2<-(dataset$promotional_offer - dataset$PO_MA2)/dataset$PO_MA2
  dataset$inc_PO_MA3<-(dataset$promotional_offer - dataset$PO_MA3)/dataset$PO_MA3
  
  #Deleting some columns
  
  dataset$LP_MA1<-NULL
  dataset$LP_MA2<-NULL
  dataset$LP_MA3<-NULL
  
  dataset$PO_MA1<-NULL
  dataset$PO_MA2<-NULL
  dataset$PO_MA3<-NULL
  
  names(dataset)[22:27]<-c("inc_LP_MA1","inc_LP_MA2","inc_LP_MA3","inc_PO_MA1","inc_PO_MA2",
                           "inc_PO_MA3")
  
  
  
  #------1) Lag of List price by 1 week,2 week, 3 week
  #------2) Lag of discount(promo_off) by 1 week,2 week, 3 week
  #------3) Incremental Lag of List price & promotions/discounts by 1 week,2 week, 3 week
  
  #-----------------Lag the data after aggregating by week----#
  
  #8.	Lag List price (different period lags)
  
  library(DataCombine)
  
  #List of list price by 1,2,3 dates (Date values are ordered)
  #Previous List price
  data_dum <- slide(dataset, Var = "list_price",slideBy = -1)
  
  data_dum <- slide(data_dum, Var = "list_price",slideBy = -2)
  
  data_dum <- slide(data_dum, Var = "list_price", slideBy = -3)
  
  #9.lag the promotion variables
  
  data_dum <- slide(data_dum, Var = "promotional_offer", slideBy = -1)
  
  data_dum <- slide(data_dum, Var = "promotional_offer", slideBy = -2)
  
  data_dum <- slide(data_dum, Var = "promotional_offer", slideBy = -3)
  
  data_dum <- slide(data_dum, Var = "NPS", slideBy = -1)
  
  data_dum <- slide(data_dum, Var = "NPS", slideBy = -2)
  
  data_dum <- slide(data_dum, Var = "NPS", slideBy = -3)
  
  
  data_dum <- slide(data_dum, Var = "holiday_freq", slideBy = -1)
  
  data_dum <- slide(data_dum, Var = "holiday_freq", slideBy = -2)
  
  data_dum <- slide(data_dum, Var = "holiday_freq", slideBy = -3)
  
  
  dataset <- na.omit(data_dum) 
  
  
  return(dataset)
}

Game_final <- advanced_kpi(GamingAccessory)
Home_final <- advanced_kpi(HomeAudio)
Camera_final <- advanced_kpi(CameraAccessory)
```                             
### EDA function is created to plot the descriptive analysis results
```{r message=FALSE, warning=FALSE}
EDA <- function(dataset,name){
  # Ad_Stock
  plot1 <- ggplot(dataset,aes(TV,gmv))+geom_point()+ geom_smooth(aes(method="lm"))+ggtitle(name) + labs(x = "TV AdStock", y = "GMV")
  plot1
  
  plot2 <- ggplot(dataset,aes(Digital,gmv))+geom_point()+ geom_smooth(aes(method="lm"))+ggtitle(name) + labs(x = "Digital AdStock", y = "GMV")
  plot2
  
  plot3 <- ggplot(dataset,aes(Sponsorship,gmv))+geom_point()+ geom_smooth(aes(method="lm"))+ggtitle(name) + labs(x = "Sponsorship AdStock", y = "GMV")
  plot3
  
  plot4 <- ggplot(dataset,aes(Content.Marketing,gmv))+geom_point()+ geom_smooth(aes(method="lm"))+ggtitle(name) + labs(x = "Content Marketing AdStock", y = "GMV")
  plot4
  
  plot5 <- ggplot(dataset,aes(Online_marketing,gmv))+geom_point()+ geom_smooth(aes(method="lm"))+ggtitle(name) + labs(x = "Online Marketing AdStock", y = "GMV")
  plot5
  
  plot6 <- ggplot(dataset,aes(Affiliates,gmv))+geom_point()+ geom_smooth(aes(method="lm"))+ggtitle(name) + labs(x = "Affiliates AdStock", y = "GMV")
  plot6
  
  plot7 <- ggplot(dataset,aes(SEM,gmv))+geom_point()+ geom_smooth(aes(method="lm"))+ggtitle(name) + labs(x = "SEM AdStock", y = "GMV")
  plot7

  plot8 <- ggplot(dataset,aes(dataset$week_year,dataset$gmv, fill = as.factor(ifelse(dataset$holiday_freq>0,1,0))))+geom_bar(stat="identity") + labs(fill = "Holiday_flag", x = "Week", y = "GMV") + ggtitle(name)
  plot8
  
 
}
EDA(Game_final,"Gaming Accessory") 
``` 

```{r message=FALSE, warning=FALSE}
#Camera_final

EDA(Camera_final,"Camera Accessory")
```
```{r message=FALSE, warning=FALSE}

# Home_final
EDA(Home_final,"Home Audio")
```
# Model on Camera Accessory Dataset

```{r message=FALSE, warning=FALSE}

Cross_camera<- rep(0,5)
```

# Build the Basic Linear regression model
```{r message=FALSE, warning=FALSE}
Linear_model <- Camera_final

Linear_model <- Linear_model[,-c(1:4,10:12,28:39)]

Linear_model <- scale(Linear_model)

Linear_model <-data.frame(Linear_model)

model_1 <- lm(gmv~.,Linear_model)


################################################################################################
```
# Summary of Linear Model 
```{r message=FALSE, warning=FALSE}
summary(model_1)

```
```{r message=FALSE, warning=FALSE}
library(car)
library(MASS)

model_2 <- stepAIC(model_1,direction = "both")

summary(model_2) 

vif(model_2)

```
```{r message=FALSE, warning=FALSE}
model_3 <- lm(formula = gmv ~ SLA + promotional_offer + Procurement_SLA + 
                per_order + NPS + TV + Digital + Sponsorship + Online_marketing + 
                inc_LP_MA2 + inc_PO_MA1 + inc_PO_MA2 + inc_PO_MA3, 
              data = Linear_model)


summary(model_3) 

vif(model_3)
```
```{r message=FALSE, warning=FALSE}
model_4 <-  lm(formula = gmv ~ SLA + promotional_offer + Procurement_SLA + 
                 per_order + NPS + TV + Digital + Sponsorship + Online_marketing + 
                 inc_LP_MA2 + inc_PO_MA1 + inc_PO_MA3, 
               data = Linear_model)


summary(model_4) 

vif(model_4)
```
```{r message=FALSE, warning=FALSE}

model_5 <- lm(formula = gmv ~ SLA + promotional_offer + Procurement_SLA + 
                per_order + TV + Digital + Sponsorship + Online_marketing + 
                inc_LP_MA2 + inc_PO_MA1 + inc_PO_MA3, 
              data = Linear_model)


summary(model_5) 

vif(model_5)

```
```{r message=FALSE, warning=FALSE}
model_6 <- lm(formula = gmv ~ SLA + Procurement_SLA + 
                per_order + TV + Digital + Sponsorship + Online_marketing + 
                inc_LP_MA2 + inc_PO_MA1 + inc_PO_MA3, 
              data = Linear_model)

summary(model_6) 

vif(model_6)

```
```{r message=FALSE, warning=FALSE}
model_7 <- lm(formula = gmv ~ SLA + Procurement_SLA + 
                per_order + TV + Digital + Sponsorship + Online_marketing + 
                inc_LP_MA2 + inc_PO_MA1, 
              data = Linear_model)



summary(model_7)

vif(model_7)
```
```{r message=FALSE, warning=FALSE}
model_8 <- lm(formula = gmv ~ SLA + Procurement_SLA + 
                per_order + TV + Digital + Sponsorship + Online_marketing + 
                inc_PO_MA1, 
              data = Linear_model)


summary(model_8)

vif(model_8)
```
```{r message=FALSE, warning=FALSE}
model_9 <- lm(formula = gmv ~ SLA + Procurement_SLA + 
                TV + Digital + Sponsorship + Online_marketing + 
                inc_PO_MA1, 
              data = Linear_model)

summary(model_9)

```
```{r message=FALSE, warning=FALSE}
model_10 <- lm(formula = gmv ~ SLA + Procurement_SLA + 
                 Digital + Sponsorship + Online_marketing + 
                 inc_PO_MA1, 
               data = Linear_model)


summary(model_10)
```
```{r message=FALSE, warning=FALSE}

model_11 <- lm(formula = gmv ~ SLA + Procurement_SLA + 
                 Digital + Sponsorship + 
                 inc_PO_MA1, 
               data = Linear_model)


summary(model_11)

```
```{r message=FALSE, warning=FALSE}
model_12 <- lm(formula = gmv ~ SLA + 
                 Digital + Sponsorship + 
                 inc_PO_MA1, 
               data = Linear_model)


summary(model_12)

```

### Final Model 
```{r message=FALSE, warning=FALSE}
Linear_Final_model_camera <- model_12

# Adj R square  = 0.3539  with 4 variables

temp_crossval <- cv.lm(data = Linear_model, form.lm = formula(gmv ~ SLA + Digital + Sponsorship + inc_PO_MA1),m = 10)
                                                                
Cross_camera[1] <- attr(temp_crossval, "ms")

################################################################################
```
## Elasticity Analysis
```{r message=FALSE, warning=FALSE}

train <- Linear_model


grlm <- Linear_Final_model_camera


# estimating the elasticity coefficients

elasticity <- function(var){
  
  elax1 <-as.numeric(grlm$coefficients[var]*mean(train[,var])/mean(train$gmv))
  
  return(elax1)
} 

var_list <- list()

for(i in 2:length(grlm$coefficients)){
  
  var_list[i-1] <-elasticity(names(grlm$coefficients)[i])
  
}

elasticity.outputs <- data.frame(names(grlm$coefficients[2:length(grlm$coefficients)]))
elasticity.outputs <- cbind(elasticity.outputs,do.call(rbind.data.frame, var_list))
colnames(elasticity.outputs) <- c("Variable","Elasticity")

elasticity.outputs$direction <- ifelse(elasticity.outputs$Elasticity > 0, "Positive", "Negative")


ggplot(data=elasticity.outputs, aes(x=reorder(Variable,Elasticity),y=Elasticity)) +
  geom_bar(position="dodge",stat="identity") + 
  coord_flip() +
  ggtitle("Camera Accessory - Linear Model") +xlab("Variables")

```
## Multiplicative Model
```{r message=FALSE, warning=FALSE}
Camera_multi <- Camera_final
Camera_multi <- Camera_multi[,-c(1:4,10:12,13,22:39)]

```
# Treatment
```{r message=FALSE, warning=FALSE}
Camera_multi$Content.Marketing[which(Camera_multi$Content.Marketing==0)] <- 0.01

Camera_multi$per_order[which(Camera_multi$per_order==0)] <- 0.01

Camera_multi <- log(Camera_multi)

```

### Build the First model ##
```{r message=FALSE, warning=FALSE}
multi_model <- lm(gmv~.,Camera_multi)

summary(multi_model)
```
```{r message=FALSE, warning=FALSE}
library(car)
library(MASS)

multi_model_2 <- stepAIC(multi_model,direction = "both")

summary(multi_model_2)

vif(multi_model_2)

```
```{r message=FALSE, warning=FALSE}
model_3 <- lm(formula = gmv ~ per_order + NPS + TV + Digital + Online_marketing + 
                SEM, data = Camera_multi)



summary(model_3) 

vif(model_3)

```
```{r message=FALSE, warning=FALSE}

model_4 <- lm(formula = gmv ~ per_order + NPS + TV + Digital + Online_marketing
              , data = Camera_multi)

summary(model_4)

vif(model_4)

```
```{r message=FALSE, warning=FALSE}
model_5 <- lm(formula = gmv ~ per_order + NPS + Digital + Online_marketing
              , data = Camera_multi)

summary(model_5)

vif(model_5)
```
```{r message=FALSE, warning=FALSE}

model_6 <- lm(formula = gmv ~ per_order + NPS + Digital
              , data = Camera_multi)

summary(model_6)

vif(model_6)
```
```{r message=FALSE, warning=FALSE}

model_7 <- lm(formula = gmv ~ per_order + NPS
              , data = Camera_multi)

summary(model_7)
```


### Multiplicative : Final Model Model-7
```{r message=FALSE, warning=FALSE}
multi_final_model_camera <- model_7

#Adj R2 = 0.834  with 2 significant variables 

temp_crossval <- cv.lm(data = Camera_multi, form.lm = formula(gmv ~ per_order + NPS),m = 10)
Cross_camera[2] <- attr(temp_crossval, "ms")
```


### Elasticity Analysis
```{r message=FALSE, warning=FALSE}
train <- Camera_multi


grlm <- multi_final_model_camera


# estimating the elasticity coefficients

elasticity <- function(var){
  
  elax1 <-as.numeric(grlm$coefficients[var]*mean(train[,var])/mean(train$gmv))
  
  return(elax1)
} 

var_list <- list()

for(i in 2:length(grlm$coefficients)){
  
  var_list[i-1] <-elasticity(names(grlm$coefficients)[i])
  
}

elasticity.outputs <- data.frame(names(grlm$coefficients[2:length(grlm$coefficients)]))
elasticity.outputs <- cbind(elasticity.outputs,do.call(rbind.data.frame, var_list))
colnames(elasticity.outputs) <- c("Variable","Elasticity")

elasticity.outputs$direction <- ifelse(elasticity.outputs$Elasticity > 0, "Positive", "Negative")


ggplot(data=elasticity.outputs, aes(x=reorder(Variable,Elasticity),y=Elasticity)) +
  geom_bar(position="dodge",stat="identity") + 
  coord_flip() +
  ggtitle("Camera Accessory - Multiplicative Model") +xlab("Variables")
```
## Kyock Models
```{r message=FALSE, warning=FALSE}
Camera_koyck<- Camera_final[,-c(1:4,10:12,28:39)]


# gmv 1 lag
Camera_koyck <- slide(Camera_koyck, Var = "gmv",slideBy = -1)


Camera_koyck <- na.omit(Camera_koyck)

Camera_koyck <- scale(Camera_koyck)

Camera_koyck <- data.frame(Camera_koyck)

# Build first model
Koy_model <- lm(gmv~.,Camera_koyck)

summary(Koy_model)

model_2 <- stepAIC(Koy_model,direction = "both")

summary(model_2)  
vif(model_2)
```
```{r message=FALSE, warning=FALSE}
model_3 <- lm(formula = gmv ~ SLA + promotional_offer + Procurement_SLA + 
                per_order + NPS + holiday_freq + TV + Digital + Sponsorship + 
                Online_marketing + inc_LP_MA2 + inc_PO_MA1 + inc_PO_MA2 + 
                inc_PO_MA3, data = Camera_koyck)


summary(model_3)

vif(model_3)

```
```{r message=FALSE, warning=FALSE}
model_4 <- lm(formula = gmv ~ SLA + promotional_offer + Procurement_SLA + 
                per_order + NPS + holiday_freq + TV + Digital + Sponsorship + 
                Online_marketing + inc_LP_MA2 + inc_PO_MA1 + 
                inc_PO_MA3, data = Camera_koyck)


summary(model_4)

vif(model_4)

```
```{r message=FALSE, warning=FALSE}
model_5 <- lm(formula = gmv ~ SLA + promotional_offer + Procurement_SLA + 
                per_order + holiday_freq + TV + Digital + Sponsorship + 
                Online_marketing + inc_LP_MA2 + inc_PO_MA1 + 
                inc_PO_MA3, data = Camera_koyck)

summary(model_5)

vif(model_5)
```
```{r message=FALSE, warning=FALSE}

model_6 <- lm(formula = gmv ~ SLA + Procurement_SLA + 
                per_order + holiday_freq + TV + Digital + Sponsorship + 
                Online_marketing + inc_LP_MA2 + inc_PO_MA1 + 
                inc_PO_MA3, data = Camera_koyck)


summary(model_6)

vif(model_6)
```
```{r message=FALSE, warning=FALSE}

model_7 <- lm(formula = gmv ~ SLA + Procurement_SLA + 
                per_order + holiday_freq + TV + Digital + Sponsorship + 
                Online_marketing + inc_LP_MA2 + inc_PO_MA1 
              , data = Camera_koyck)

summary(model_7)

vif(model_7)
```
```{r message=FALSE, warning=FALSE}

model_8 <- lm(formula = gmv ~ SLA + Procurement_SLA + 
                per_order + holiday_freq + TV + Digital + Sponsorship + 
                Online_marketing + inc_PO_MA1 
              , data = Camera_koyck)

summary(model_8)

vif(model_8)

```
```{r message=FALSE, warning=FALSE}
model_9 <- lm(formula = gmv ~ SLA + Procurement_SLA + 
                per_order + TV + Digital + Sponsorship + 
                Online_marketing + inc_PO_MA1 
              , data = Camera_koyck)

summary(model_9)

vif(model_9)
```
```{r message=FALSE, warning=FALSE}

model_10 <- lm(formula = gmv ~ SLA + Procurement_SLA + 
                 TV + Digital + Sponsorship + 
                 Online_marketing + inc_PO_MA1 
               , data = Camera_koyck)

summary(model_10)
```
```{r message=FALSE, warning=FALSE}

model_11 <- lm(formula = gmv ~ SLA + Procurement_SLA + 
                 Digital + Sponsorship + 
                 Online_marketing + inc_PO_MA1 
               , data = Camera_koyck)

summary(model_11)
```
```{r message=FALSE, warning=FALSE}
model_12 <- lm(formula = gmv ~ SLA +  
                 Digital + Sponsorship + 
                 Online_marketing + inc_PO_MA1 
               , data = Camera_koyck)

summary(model_12)
```
```{r message=FALSE, warning=FALSE}
model_13 <- lm(formula = gmv ~ Digital + Sponsorship + 
                 Online_marketing + inc_PO_MA1 
               , data = Camera_koyck)

summary(model_13)
```
```{r message=FALSE, warning=FALSE}
model_14 <- lm(formula = gmv ~ Digital + Sponsorship + 
                 Online_marketing 
               , data = Camera_koyck)

summary(model_14)
```
##Final Model
```{r message=FALSE, warning=FALSE}
 
koyck_Final_Model_camera <- model_14 

# Adj R square  = 0.3503 with 3 significant variable 

temp_crossval <- cv.lm(data = Camera_koyck, form.lm = formula(gmv ~ Digital + Sponsorship + Online_marketing ),m = 10)
                                                                
Cross_camera[3] <- attr(temp_crossval, "ms")


```
## Elasticity Analysis
```{r message=FALSE, warning=FALSE}


train <- Camera_koyck


grlm <- koyck_Final_Model_camera


# estimating the elasticity coefficients

elasticity <- function(var){
  
  elax1 <-as.numeric(grlm$coefficients[var]*mean(train[,var])/mean(train$gmv))
  
  return(elax1)
} 

var_list <- list()

for(i in 2:length(grlm$coefficients)){
  
  var_list[i-1] <-elasticity(names(grlm$coefficients)[i])
  
}

elasticity.outputs <- data.frame(names(grlm$coefficients[2:length(grlm$coefficients)]))
elasticity.outputs <- cbind(elasticity.outputs,do.call(rbind.data.frame, var_list))
colnames(elasticity.outputs) <- c("Variable","Elasticity")

elasticity.outputs$direction <- ifelse(elasticity.outputs$Elasticity > 0, "Positive", "Negative")


ggplot(data=elasticity.outputs, aes(x=reorder(Variable,Elasticity),y=Elasticity)) +
  geom_bar(position="dodge",stat="identity") + 
  coord_flip() +
  ggtitle("Camera Accessory - Koyck Model") +xlab("Variables")

```
## Distributed lag models 

```{r message=FALSE, warning=FALSE}

Dis_Model <- Camera_final[,-c(1:4,10:12, 28:30)]

Dis_model_1 <- slide(Dis_Model, Var = "gmv",slideBy = -1)

Dis_model_1 <- slide(Dis_model_1, Var = "gmv",slideBy = -2)

Dis_model_1 <- slide(Dis_model_1, Var = "gmv",slideBy = -3)

Dis_model <- na.omit(Dis_model_1)

Dis_model <- scale(Dis_model)
Dis_model <- data.frame(Dis_model)

```
## Lag distribution model: 
```{r message=FALSE, warning=FALSE}



dist_model <- lm(gmv~.,Dis_model)

summary(dist_model)


model_2 <- stepAIC(dist_model,direction = "both")

summary(model_2)

vif(model_2)

```
```{r message=FALSE, warning=FALSE}

model_3 <- lm(formula = gmv ~ SLA + promotional_offer + per_order + NPS + 
                Digital + Sponsorship + Content.Marketing + Online_marketing + 
                Affiliates + SEM + inc_LP_MA2 + inc_LP_MA3 + inc_PO_MA1 + 
                promotional_offer.2 + promotional_offer.3 + 
                NPS.3 + holiday_freq.1 + holiday_freq.2 + gmv.2, data = Dis_model)

summary(model_3)


vif(model_3)

```
```{r message=FALSE, warning=FALSE}

model_4 <- lm(formula = gmv ~ SLA + promotional_offer + per_order + NPS + 
                Digital + Sponsorship + Content.Marketing + 
                Affiliates + SEM + inc_LP_MA2 + inc_LP_MA3 + inc_PO_MA1 + 
                promotional_offer.2 + promotional_offer.3 + 
                NPS.3 + holiday_freq.1 + holiday_freq.2 + gmv.2, data = Dis_model)


summary(model_4)


vif(model_4)
```
```{r message=FALSE, warning=FALSE}

model_5 <- lm(formula = gmv ~ SLA + promotional_offer + per_order + NPS + 
                Digital + Sponsorship + Content.Marketing + 
                Affiliates + inc_LP_MA2 + inc_LP_MA3 + inc_PO_MA1 + 
                promotional_offer.2 + promotional_offer.3 + 
                NPS.3 + holiday_freq.1 + holiday_freq.2 + gmv.2, data = Dis_model)

summary(model_5)
```
```{r message=FALSE, warning=FALSE}

vif(model_5)


model_6 <- lm(formula = gmv ~ SLA + promotional_offer + per_order + NPS + 
                Digital + Sponsorship + Content.Marketing + 
                Affiliates + inc_LP_MA3 + inc_PO_MA1 + 
                promotional_offer.2 + promotional_offer.3 + 
                NPS.3 + holiday_freq.1 + holiday_freq.2 + gmv.2, data = Dis_model)


summary(model_6)


vif(model_6)
```
```{r message=FALSE, warning=FALSE}

model_7 <- lm(formula = gmv ~ SLA + promotional_offer + per_order + NPS + 
                Digital + Sponsorship + 
                Affiliates + inc_LP_MA3 + inc_PO_MA1 + 
                promotional_offer.2 + promotional_offer.3 + 
                NPS.3 + holiday_freq.1 + holiday_freq.2 + gmv.2, data = Dis_model)

summary(model_7)


vif(model_7)
```
```{r message=FALSE, warning=FALSE}

model_8 <- lm(formula = gmv ~ SLA + promotional_offer + per_order + 
                Digital + Sponsorship + 
                Affiliates + inc_LP_MA3 + inc_PO_MA1 + 
                promotional_offer.2 + promotional_offer.3 + 
                NPS.3 + holiday_freq.1 + holiday_freq.2 + gmv.2, data = Dis_model)
summary(model_8)


vif(model_8)

model_9 <- lm(formula = gmv ~ SLA + per_order + 
                Digital + Sponsorship + 
                Affiliates + inc_LP_MA3 + inc_PO_MA1 + 
                promotional_offer.2 + promotional_offer.3 + 
                NPS.3 + holiday_freq.1 + holiday_freq.2 + gmv.2, data = Dis_model)

summary(model_9)

vif(model_9)
```
```{r message=FALSE, warning=FALSE}
model_10 <- lm(formula = gmv ~ SLA + per_order + 
                 Sponsorship + 
                 Affiliates + inc_LP_MA3 + inc_PO_MA1 + 
                 promotional_offer.2 + promotional_offer.3 + 
                 NPS.3 + holiday_freq.1 + holiday_freq.2 + gmv.2, data = Dis_model)


summary(model_10)
vif(model_10)

```
```{r message=FALSE, warning=FALSE}
model_11 <- lm(formula = gmv ~ SLA + per_order + 
                 Sponsorship + 
                 Affiliates + inc_PO_MA1 + 
                 promotional_offer.2 + promotional_offer.3 + 
                 NPS.3 + holiday_freq.1 + holiday_freq.2 + gmv.2, data = Dis_model)

summary(model_11)

vif(model_11)
```
```{r message=FALSE, warning=FALSE}
model_12 <- lm(formula = gmv ~ SLA + 
                 Sponsorship + 
                 Affiliates + inc_PO_MA1 + 
                 promotional_offer.2 + promotional_offer.3 + 
                 NPS.3 + holiday_freq.1 + holiday_freq.2 + gmv.2, data = Dis_model)


summary(model_12)

vif(model_12)
```
```{r message=FALSE, warning=FALSE}
model_13 <- lm(formula = gmv ~ SLA + 
                 Sponsorship + 
                 Affiliates + inc_PO_MA1 + 
                 promotional_offer.2 + promotional_offer.3 + 
                 NPS.3 + holiday_freq.1 + gmv.2, data = Dis_model)

summary(model_13)

vif(model_13)

```
```{r message=FALSE, warning=FALSE}
model_14 <- lm(formula = gmv ~ SLA + 
                 Sponsorship + 
                 Affiliates + inc_PO_MA1 + 
                 promotional_offer.2 + promotional_offer.3 + 
                 holiday_freq.1 + gmv.2, data = Dis_model)

summary(model_14)
```
```{r message=FALSE, warning=FALSE}
model_15 <- lm(formula = gmv ~ SLA + 
                 Sponsorship + 
                 Affiliates + inc_PO_MA1 + 
                 promotional_offer.2 + promotional_offer.3 + 
                 holiday_freq.1, data = Dis_model)

summary(model_15)
```
```{r message=FALSE, warning=FALSE}
model_16 <- lm(formula = gmv ~ Sponsorship + 
                 Affiliates + inc_PO_MA1 + 
                 promotional_offer.2 + promotional_offer.3 + 
                 holiday_freq.1, data = Dis_model)
summary(model_16)

```
```{r message=FALSE, warning=FALSE}
model_17 <- lm(formula = gmv ~ Sponsorship + 
                 Affiliates + 
                 promotional_offer.2 + promotional_offer.3 + 
                 holiday_freq.1, data = Dis_model)
summary(model_17)

```
```{r message=FALSE, warning=FALSE}
model_18 <- lm(formula = gmv ~ Sponsorship + 
                 Affiliates + 
                 promotional_offer.2 + promotional_offer.3,
               data = Dis_model)
summary(model_18)
```
```{r message=FALSE, warning=FALSE}
model_19 <- lm(formula = gmv ~ Sponsorship + 
                 Affiliates + 
                 promotional_offer.3,
               data = Dis_model) 

summary(model_19)
```
```{r message=FALSE, warning=FALSE}
model_20 <- lm(formula = gmv ~ Sponsorship + 
                 promotional_offer.3,
               data = Dis_model) 

summary(model_20)
```
```{r message=FALSE, warning=FALSE}
##Final Model 

Dist_Final_Model_camera <- model_20

# Adj R square  = 0.2604 with 2 significant variables

temp_crossval <- cv.lm(data = Dis_model, form.lm = formula(gmv ~ Sponsorship + promotional_offer.3),m = 10)
                                                             
Cross_camera[4] <- attr(temp_crossval, "ms")
```
### Elasticity Analysis
```{r message=FALSE, warning=FALSE}


train <- Dis_model


grlm <- Dist_Final_Model_camera


# estimating the elasticity coefficients

elasticity <- function(var){
  
  elax1 <-as.numeric(grlm$coefficients[var]*mean(train[,var])/mean(train$gmv))
  
  return(elax1)
} 

var_list <- list()

for(i in 2:length(grlm$coefficients)){
  
  var_list[i-1] <-elasticity(names(grlm$coefficients)[i])
  
}

elasticity.outputs <- data.frame(names(grlm$coefficients[2:length(grlm$coefficients)]))
elasticity.outputs <- cbind(elasticity.outputs,do.call(rbind.data.frame, var_list))
colnames(elasticity.outputs) <- c("Variable","Elasticity")

elasticity.outputs$direction <- ifelse(elasticity.outputs$Elasticity > 0, "Positive", "Negative")


ggplot(data=elasticity.outputs, aes(x=reorder(Variable,Elasticity),y=Elasticity)) +
  geom_bar(position="dodge",stat="identity") + 
  coord_flip() +
  ggtitle("Camera Accessory - Distributed Lag Model") +xlab("Variables")

```
### Multiplicative + distributed model: 
```{r message=FALSE, warning=FALSE}


Multi_dist <- Camera_final[-c(1:4,10:13,22:30,37:39)] # Not considered moving averages.

# gmv

Multi_Dis_model_1 <- slide(Multi_dist, Var = "gmv",slideBy = -1)

Multi_Dis_model_1 <- slide(Multi_Dis_model_1, Var = "gmv",slideBy = -2)

Multi_Dis_model_1 <- slide(Multi_Dis_model_1, Var = "gmv",slideBy = -3)

Multi_dist <- na.omit(Multi_Dis_model_1)

colnames(Multi_dist)[14:22]<- c("promotional_offer_1","promotional_offer_2","promotional_offer_3","NPS_1",
                                "NPS_2","NPS_3", "gmv_1", "gmv_2", "gmv_3")

Multi_dist$Content.Marketing[which(Multi_dist$Content.Marketing==0)] <-1
Multi_dist$per_order[which(Multi_dist$per_order==0)] <-0.01


```
```{r message=FALSE, warning=FALSE}
Multi_dist <- log(Multi_dist)

model_1 <- lm(gmv~., Multi_dist)

summary(model_1)

model_2 <- stepAIC(model_1,direction = "both")

summary(model_2) 

vif(model_2)
```
```{r message=FALSE, warning=FALSE}

model_3 <- lm(formula = gmv ~ promotional_offer + Procurement_SLA + per_order + 
                Digital + Affiliates + SEM + gmv_1, 
              data = Multi_dist)

summary(model_3)

vif(model_3)

```
```{r message=FALSE, warning=FALSE}
model_4 <- lm(formula = gmv ~ promotional_offer + Procurement_SLA + per_order + 
                Digital + Affiliates + gmv_1, 
              data = Multi_dist)

summary(model_4)

vif(model_4)

```
```{r message=FALSE, warning=FALSE}
model_5 <- lm(formula = gmv ~ promotional_offer + Procurement_SLA + per_order + 
                Digital + gmv_1, 
              data = Multi_dist)

summary(model_5)

vif(model_5)

```
```{r message=FALSE, warning=FALSE}

model_6 <- lm(formula = gmv ~ promotional_offer + per_order + 
                Digital + gmv_1, 
              data = Multi_dist)

summary(model_6)

vif(model_6)
```
```{r message=FALSE, warning=FALSE}

model_7 <- lm(formula = gmv ~ promotional_offer + per_order + 
                gmv_1, 
              data = Multi_dist)

summary(model_7)

vif(model_7)

# Adjusted R-squared:  0.7581  with 3 significant variables

Multi_Dist_Final_Model_camera <- model_7

temp_crossval <- cv.lm(data = Multi_dist, form.lm = formula(gmv ~ promotional_offer + per_order + gmv_1),m = 10)
                                                              
Cross_camera[5] <- attr(temp_crossval, "ms")


```
## Elasticity Analysis
```{r message=FALSE, warning=FALSE}
train <- Multi_dist


grlm <- Multi_Dist_Final_Model_camera


# estimating the elasticity coefficients

elasticity <- function(var){
  
  elax1 <-as.numeric(grlm$coefficients[var]*mean(train[,var])/mean(train$gmv))
  
  return(elax1)
} 

var_list <- list()

for(i in 2:length(grlm$coefficients)){
  
  var_list[i-1] <-elasticity(names(grlm$coefficients)[i])
  
}

elasticity.outputs <- data.frame(names(grlm$coefficients[2:length(grlm$coefficients)]))
elasticity.outputs <- cbind(elasticity.outputs,do.call(rbind.data.frame, var_list))
colnames(elasticity.outputs) <- c("Variable","Elasticity")

elasticity.outputs$direction <- ifelse(elasticity.outputs$Elasticity > 0, "Positive", "Negative")


ggplot(data=elasticity.outputs, aes(x=reorder(Variable,Elasticity),y=Elasticity)) +
  geom_bar(position="dodge",stat="identity") + 
  coord_flip() +
  ggtitle("Camera Accessory - Multiplicative & Distributed Lag Model") +xlab("Variables")



```
# Model on Game Accessory Datase
```{r message=FALSE, warning=FALSE}

Cross_game<- rep(0,5)

# Building the Basicc Linear regression Model
```
```{r message=FALSE, warning=FALSE}
Linear_model <- Game_final

Linear_model <- Linear_model[,-c(1:4,10:12,28:39)]

Linear_model <- scale(Linear_model)

Linear_model <-data.frame(Linear_model)

model_1 <- lm(gmv~.,Linear_model)


```
```{r message=FALSE, warning=FALSE}

# Summary of Linear Model 
summary(model_1)


library(car)
library(MASS)

model_2 <- stepAIC(model_1,direction = "both")

summary(model_2) 

vif(model_2)
```
```{r message=FALSE, warning=FALSE}

model_3 <- lm(formula = gmv ~ Procurement_SLA + per_order + NPS + TV + 
                Sponsorship + Content.Marketing + SEM + inc_LP_MA1 + inc_LP_MA2 + 
                inc_LP_MA3 + inc_PO_MA2 + inc_PO_MA3, data = Linear_model)


summary(model_3) 

vif(model_3)
```
```{r message=FALSE, warning=FALSE}
model_4 <-  lm(formula = gmv ~ Procurement_SLA + per_order + NPS + TV + 
                 Sponsorship + SEM + inc_LP_MA1 + inc_LP_MA2 + 
                 inc_LP_MA3 + inc_PO_MA2 + inc_PO_MA3, data = Linear_model)


summary(model_4) 

vif(model_4)

```
```{r message=FALSE, warning=FALSE}
model_5 <- lm(formula = gmv ~ Procurement_SLA + per_order + NPS + TV + 
                Sponsorship + SEM + inc_LP_MA1 + inc_LP_MA2 + inc_PO_MA2 + inc_PO_MA3, data = Linear_model)



summary(model_5) 

vif(model_5)

```
```{r message=FALSE, warning=FALSE}
model_6 <- lm(formula = gmv ~ Procurement_SLA + per_order + NPS + TV + 
                Sponsorship + SEM + inc_LP_MA1 + inc_LP_MA2 + inc_PO_MA2, data = Linear_model)


summary(model_6) 

vif(model_6)

```
```{r message=FALSE, warning=FALSE}
model_7 <- lm(formula = gmv ~ Procurement_SLA + per_order + NPS + TV + 
                Sponsorship + SEM + inc_LP_MA1 +  inc_PO_MA2, data = Linear_model)



summary(model_7)

vif(model_7)
```
```{r message=FALSE, warning=FALSE}
model_8 <- lm(formula = gmv ~ Procurement_SLA + per_order + NPS + TV + 
                SEM + inc_LP_MA1 +  inc_PO_MA2, data = Linear_model)


summary(model_8)

vif(model_8)
```
```{r message=FALSE, warning=FALSE}
model_9 <- lm(formula = gmv ~ Procurement_SLA + per_order + NPS +  
                SEM + inc_LP_MA1 +  inc_PO_MA2, data = Linear_model)

summary(model_9)
```
```{r message=FALSE, warning=FALSE}

model_10 <- lm(formula = gmv ~ Procurement_SLA + per_order + NPS +  
                 SEM +   inc_PO_MA2, data = Linear_model)


summary(model_10)
```
```{r message=FALSE, warning=FALSE}

model_11 <- lm(formula = gmv ~  per_order + NPS +  
                 SEM +   inc_PO_MA2, data = Linear_model)


summary(model_11)

```
```{r message=FALSE, warning=FALSE}
model_12 <- lm(formula = gmv ~   NPS +  
                 SEM +   inc_PO_MA2, data = Linear_model)


summary(model_12)
```
```{r message=FALSE, warning=FALSE}

##Final Model 
Linear_Final_model_game <- model_12

# Adj R square  = 0.3606  with 3 variables

temp_crossval <- cv.lm(data = Linear_model, form.lm = formula(gmv ~ NPS + SEM + inc_PO_MA2),m = 10)
Cross_game[1] <- attr(temp_crossval, "ms")
```
```{r message=FALSE, warning=FALSE}
##############################################################################################################
# Elasticity Analysis

train <- Linear_model


grlm <- Linear_Final_model_game

```
```{r message=FALSE, warning=FALSE}
# estimating the elasticity coefficients

elasticity <- function(var){
  
  elax1 <-as.numeric(grlm$coefficients[var]*mean(train[,var])/mean(train$gmv))
  
  return(elax1)
} 

var_list <- list()

for(i in 2:length(grlm$coefficients)){
  
  var_list[i-1] <-elasticity(names(grlm$coefficients)[i])
  
}

elasticity.outputs <- data.frame(names(grlm$coefficients[2:length(grlm$coefficients)]))
elasticity.outputs <- cbind(elasticity.outputs,do.call(rbind.data.frame, var_list))
colnames(elasticity.outputs) <- c("Variable","Elasticity")

elasticity.outputs$direction <- ifelse(elasticity.outputs$Elasticity > 0, "Positive", "Negative")
View(elasticity.outputs)


ggplot(data=elasticity.outputs, aes(x=reorder(Variable,Elasticity),y=Elasticity)) +
  geom_bar(position="dodge",stat="identity") + 
  coord_flip() +
  ggtitle("Game Accessory - Linear Model") +xlab("Variables")

#####################################################################################################################
#####################################################################################################################
########################################## Multiplicative Model #####################################################
```
```{r message=FALSE, warning=FALSE}
Game_multi <- Game_final
Game_multi <- Game_multi[,-c(1:4,10:12,13,22:39)]


```
```{r message=FALSE, warning=FALSE}
# Treatment

Game_multi$Content.Marketing[which(Game_multi$Content.Marketing==0)] <- 0.01

Game_multi$per_order[which(Game_multi$per_order==0)] <- 0.01

Game_multi <- log(Game_multi)

################################################
#################################################
```
```{r message=FALSE, warning=FALSE}
## Build the First model ##

multi_model <- lm(gmv~.,Game_multi)

summary(multi_model)

library(car)
library(MASS)

multi_model_2 <- stepAIC(multi_model,direction = "both")

summary(multi_model_2)

vif(multi_model_2)

```
```{r message=FALSE, warning=FALSE}
model_3 <- lm(formula = gmv ~ SLA + per_order + NPS + TV + Sponsorship + 
                Content.Marketing + Affiliates, data = Game_multi)



summary(model_3) 

vif(model_3)
```
```{r message=FALSE, warning=FALSE}


model_4 <- lm(formula = gmv ~ SLA + per_order + NPS + Sponsorship + 
                Content.Marketing + Affiliates, data = Game_multi)
summary(model_4)

vif(model_4)
```
```{r message=FALSE, warning=FALSE}

model_5 <- lm(formula = gmv ~ SLA + per_order + Sponsorship + 
                Content.Marketing + Affiliates, data = Game_multi)

summary(model_5)

vif(model_5)
```
```{r message=FALSE, warning=FALSE}

model_6 <- lm(formula = gmv ~ SLA + per_order + Sponsorship + 
                Affiliates, data = Game_multi)

summary(model_6)

vif(model_6)

```
```{r message=FALSE, warning=FALSE}
model_7 <- lm(formula = gmv ~ per_order + Sponsorship + 
                Affiliates, data = Game_multi)

summary(model_7)

model_8 <- lm(formula = gmv ~ per_order + 
                Affiliates, data = Game_multi)


summary(model_8)

```
```{r message=FALSE, warning=FALSE}
### 
# Multiplicative : Final Model Model-9

multi_final_model_game <- model_8

#Adj R2 = 0.5844  with 2 significant variables 

temp_crossval <- cv.lm(data = Game_multi, form.lm = formula(gmv ~ per_order + Affiliates),m = 10)
Cross_game[2] <- attr(temp_crossval, "ms")

#############################################################################
```
```{r message=FALSE, warning=FALSE}
# Elasticity Analysis# 

train <- Game_multi


grlm <- multi_final_model_game
```
```{r message=FALSE, warning=FALSE}

# estimating the elasticity coefficients

elasticity <- function(var){
  
  elax1 <-as.numeric(grlm$coefficients[var]*mean(train[,var])/mean(train$gmv))
  
  return(elax1)
} 
```
```{r message=FALSE, warning=FALSE}
var_list <- list()

for(i in 2:length(grlm$coefficients)){
  
  var_list[i-1] <-elasticity(names(grlm$coefficients)[i])
  
}
```
```{r message=FALSE, warning=FALSE}
elasticity.outputs <- data.frame(names(grlm$coefficients[2:length(grlm$coefficients)]))
elasticity.outputs <- cbind(elasticity.outputs,do.call(rbind.data.frame, var_list))
colnames(elasticity.outputs) <- c("Variable","Elasticity")

elasticity.outputs$direction <- ifelse(elasticity.outputs$Elasticity > 0, "Positive", "Negative")
View(elasticity.outputs)
```
```{r message=FALSE, warning=FALSE}

ggplot(data=elasticity.outputs, aes(x=reorder(Variable,Elasticity),y=Elasticity)) +
  geom_bar(position="dodge",stat="identity") + 
  coord_flip() +
  ggtitle("Game Accessory - Multiplicative Model") +xlab("Variables")
```
```{r message=FALSE, warning=FALSE}

############################################## Koyck models #################################################

Game_koyck<- Game_final[,-c(1:4,10:12,28:39)]


# gmv 1 lag
Game_koyck <- slide(Game_koyck, Var = "gmv",slideBy = -1)


Game_koyck <- na.omit(Game_koyck)

Game_koyck <- scale(Game_koyck)

Game_koyck <- data.frame(Game_koyck)

```
```{r message=FALSE, warning=FALSE}
# Build first model
Koy_model <- lm(gmv~.,Game_koyck)

summary(Koy_model)

model_2 <- stepAIC(Koy_model,direction = "both")

summary(model_2)  
vif(model_2)
```
```{r message=FALSE, warning=FALSE}
model_3 <- lm(formula = gmv ~ SLA + Procurement_SLA + per_order + NPS + 
                Digital + Sponsorship + Content.Marketing + inc_LP_MA2 + 
                inc_LP_MA3 + inc_PO_MA1 + inc_PO_MA2 + inc_PO_MA3 + gmv.1, 
              data = Game_koyck)


summary(model_3)

vif(model_3)
```
```{r message=FALSE, warning=FALSE}

model_4 <- lm(formula = gmv ~ SLA + Procurement_SLA + per_order + NPS + 
                Digital + Sponsorship + Content.Marketing + inc_LP_MA2 + 
                inc_LP_MA3 + inc_PO_MA1 + inc_PO_MA2 + gmv.1, 
              data = Game_koyck)


summary(model_4)

vif(model_4)
```
```{r message=FALSE, warning=FALSE}

model_5 <- lm(formula = gmv ~ SLA + Procurement_SLA + per_order + NPS + 
                Digital + Sponsorship + inc_LP_MA2 + 
                inc_LP_MA3 + inc_PO_MA1 + inc_PO_MA2 + gmv.1, 
              data = Game_koyck)

summary(model_5)

vif(model_5)
```
```{r message=FALSE, warning=FALSE}

model_6 <- lm(formula = gmv ~ SLA + Procurement_SLA + per_order + NPS + 
                Digital + Sponsorship + 
                inc_LP_MA3 + inc_PO_MA1 + inc_PO_MA2 + gmv.1, 
              data = Game_koyck)


summary(model_6)

vif(model_6)
```
```{r message=FALSE, warning=FALSE}

model_7 <- lm(formula = gmv ~ SLA + Procurement_SLA + per_order + NPS + 
                Digital + Sponsorship + 
                inc_LP_MA3 + inc_PO_MA1 + gmv.1, 
              data = Game_koyck)

summary(model_7)

vif(model_7)

```
```{r message=FALSE, warning=FALSE}
model_8 <- lm(formula = gmv ~ SLA + Procurement_SLA + per_order + NPS + 
                Digital + 
                inc_LP_MA3 + inc_PO_MA1 + gmv.1, 
              data = Game_koyck)

summary(model_8)

vif(model_8)
```
```{r message=FALSE, warning=FALSE}

model_9 <- lm(formula = gmv ~ SLA + per_order + NPS + 
                Digital + 
                inc_LP_MA3 + inc_PO_MA1 + gmv.1, 
              data = Game_koyck)

summary(model_9)

vif(model_9)
```
```{r message=FALSE, warning=FALSE}

model_10 <- lm(formula = gmv ~ SLA + NPS + 
                 Digital + 
                 inc_LP_MA3 + inc_PO_MA1 + gmv.1, 
               data = Game_koyck)

summary(model_10)

```
```{r message=FALSE, warning=FALSE}
model_11 <- lm(formula = gmv ~ SLA + NPS + 
                 inc_LP_MA3 + inc_PO_MA1 + gmv.1, 
               data = Game_koyck)

summary(model_11)
```
```{r message=FALSE, warning=FALSE}
model_12 <- lm(formula = gmv ~ NPS + 
                 inc_LP_MA3 + inc_PO_MA1 + gmv.1, 
               data = Game_koyck)

summary(model_12)
```
```{r message=FALSE, warning=FALSE}
##Final Model 
koyck_Final_Model_game <- model_12 

# Adj R square  = 0.4061 with 4 significant variable 

temp_crossval <- cv.lm(data = Game_koyck, form.lm = formula(gmv ~ NPS + inc_LP_MA3 + inc_PO_MA1 + gmv.1),m = 10)
Cross_game[3] <- attr(temp_crossval, "ms")

###############################################################################################
```
```{r message=FALSE, warning=FALSE}
# Elasticity Analysis

train <- Game_koyck


grlm <- koyck_Final_Model_game

```
```{r message=FALSE, warning=FALSE}
# estimating the elasticity coefficients

elasticity <- function(var){
  
  elax1 <-as.numeric(grlm$coefficients[var]*mean(train[,var])/mean(train$gmv))
  
  return(elax1)
} 

var_list <- list()

for(i in 2:length(grlm$coefficients)){
  
  var_list[i-1] <-elasticity(names(grlm$coefficients)[i])
  
}

elasticity.outputs <- data.frame(names(grlm$coefficients[2:length(grlm$coefficients)]))
elasticity.outputs <- cbind(elasticity.outputs,do.call(rbind.data.frame, var_list))
colnames(elasticity.outputs) <- c("Variable","Elasticity")

elasticity.outputs$direction <- ifelse(elasticity.outputs$Elasticity > 0, "Positive", "Negative")



ggplot(data=elasticity.outputs, aes(x=reorder(Variable,Elasticity),y=Elasticity)) +
  geom_bar(position="dodge",stat="identity") + 
  coord_flip() +
  ggtitle("Game Accessory - Koyck Model") +xlab("Variables")



############################################## Distributed lag models #################################################
```
```{r message=FALSE, warning=FALSE}
Dis_Model <- Game_final[,-c(1:4,10:12, 28:30)]

Dis_model_1 <- slide(Dis_Model, Var = "gmv",slideBy = -1)

Dis_model_1 <- slide(Dis_model_1, Var = "gmv",slideBy = -2)

Dis_model_1 <- slide(Dis_model_1, Var = "gmv",slideBy = -3)

Dis_model <- na.omit(Dis_model_1)

Dis_model <- scale(Dis_model)
Dis_model <- data.frame(Dis_model)

```
```{r message=FALSE, warning=FALSE}
# Lag distribution model: 


dist_model <- lm(gmv~.,Dis_model)

summary(dist_model)


model_2 <- stepAIC(dist_model,direction = "both")

summary(model_2)

vif(model_2)

```
```{r message=FALSE, warning=FALSE}

model_3 <- lm(formula = gmv ~ promotional_offer + Procurement_SLA + holiday_freq + 
                Sponsorship + Content.Marketing + Online_marketing + Affiliates + 
                SEM + inc_LP_MA1 + inc_LP_MA2 + inc_LP_MA3 + inc_PO_MA1 + 
                inc_PO_MA3 + promotional_offer.1 + promotional_offer.2 + 
                promotional_offer.3 + NPS.2 + NPS.3 + holiday_freq.2 + gmv.1 + 
                gmv.2 + gmv.3, data = Dis_model)

summary(model_3)


vif(model_3)
```
```{r message=FALSE, warning=FALSE}


model_4 <- lm(formula = gmv ~ promotional_offer + Procurement_SLA + holiday_freq + 
                Sponsorship + Content.Marketing + Online_marketing + Affiliates + 
                SEM + inc_LP_MA1 + inc_LP_MA2 + inc_LP_MA3 + inc_PO_MA1 + 
                promotional_offer.1 + promotional_offer.2 + 
                promotional_offer.3 + NPS.2 + NPS.3 + holiday_freq.2 + gmv.1 + 
                gmv.2 + gmv.3, data = Dis_model)


summary(model_4)


vif(model_4)
```
```{r message=FALSE, warning=FALSE}

model_5 <- lm(formula = gmv ~ promotional_offer + Procurement_SLA + holiday_freq + 
                Sponsorship + Content.Marketing + Online_marketing + Affiliates + 
                SEM + inc_LP_MA1 + inc_LP_MA2 + inc_LP_MA3 + inc_PO_MA1 + 
                promotional_offer.2 + 
                promotional_offer.3 + NPS.2 + NPS.3 + holiday_freq.2 + gmv.1 + 
                gmv.2 + gmv.3, data = Dis_model)

summary(model_5)


vif(model_5)
```
```{r message=FALSE, warning=FALSE}

model_6 <- lm(formula = gmv ~ promotional_offer + Procurement_SLA + holiday_freq + 
                Sponsorship + Content.Marketing + Affiliates + 
                SEM + inc_LP_MA1 + inc_LP_MA2 + inc_LP_MA3 + inc_PO_MA1 + 
                promotional_offer.2 + 
                promotional_offer.3 + NPS.2 + NPS.3 + holiday_freq.2 + gmv.1 + 
                gmv.2 + gmv.3, data = Dis_model)


summary(model_6)


vif(model_6)
```
```{r message=FALSE, warning=FALSE}

model_7 <- lm(formula = gmv ~ promotional_offer + Procurement_SLA + holiday_freq + 
                Sponsorship + Content.Marketing + Affiliates + 
                SEM + inc_LP_MA1 + inc_LP_MA3 + inc_PO_MA1 + 
                promotional_offer.2 + 
                promotional_offer.3 + NPS.2 + NPS.3 + holiday_freq.2 + gmv.1 + 
                gmv.2 + gmv.3, data = Dis_model)

summary(model_7)


vif(model_7)

```
```{r message=FALSE, warning=FALSE}
model_8 <- lm(formula = gmv ~ promotional_offer + Procurement_SLA + holiday_freq + 
                Sponsorship + Affiliates + 
                SEM + inc_LP_MA1 + inc_LP_MA3 + inc_PO_MA1 + 
                promotional_offer.2 + 
                promotional_offer.3 + NPS.2 + NPS.3 + holiday_freq.2 + gmv.1 + 
                gmv.2 + gmv.3, data = Dis_model)
summary(model_8)


vif(model_8)
```
```{r message=FALSE, warning=FALSE}
model_9 <- lm(formula = gmv ~ promotional_offer + Procurement_SLA + holiday_freq + 
                Sponsorship + Affiliates + 
                SEM + inc_LP_MA1 + inc_LP_MA3 + inc_PO_MA1 + 
                promotional_offer.2 + 
                promotional_offer.3 + NPS.3 + holiday_freq.2 + gmv.1 + 
                gmv.2 + gmv.3, data = Dis_model)

summary(model_9)

vif(model_9)
```
```{r message=FALSE, warning=FALSE}
model_10 <- lm(formula = gmv ~ promotional_offer + Procurement_SLA + holiday_freq + 
                 Sponsorship + Affiliates + 
                 SEM + inc_LP_MA1 + inc_PO_MA1 + 
                 promotional_offer.2 + 
                 promotional_offer.3 + NPS.3 + holiday_freq.2 + gmv.1 + 
                 gmv.2 + gmv.3, data = Dis_model)


summary(model_10)
vif(model_10)
```
```{r message=FALSE, warning=FALSE}

model_11 <- lm(formula = gmv ~ promotional_offer + Procurement_SLA + holiday_freq + 
                 Affiliates + 
                 SEM + inc_LP_MA1 + inc_PO_MA1 + 
                 promotional_offer.2 + 
                 promotional_offer.3 + NPS.3 + holiday_freq.2 + gmv.1 + 
                 gmv.2 + gmv.3, data = Dis_model)

summary(model_11)

vif(model_11)
```
```{r message=FALSE, warning=FALSE}
model_12 <- lm(formula = gmv ~ promotional_offer + Procurement_SLA + holiday_freq + 
                 Affiliates + 
                 SEM + inc_LP_MA1 + inc_PO_MA1 + 
                 promotional_offer.2 + 
                 NPS.3 + holiday_freq.2 + gmv.1 + 
                 gmv.2 + gmv.3, data = Dis_model)

summary(model_12)

vif(model_12)
```
```{r message=FALSE, warning=FALSE}
model_13 <- lm(formula = gmv ~ promotional_offer + Procurement_SLA + holiday_freq + 
                 Affiliates + 
                 SEM + inc_LP_MA1 + inc_PO_MA1 + 
                 promotional_offer.2 + 
                 NPS.3 + holiday_freq.2 + gmv.1 + 
                 gmv.3, data = Dis_model)

summary(model_13)

vif(model_13)
```
```{r message=FALSE, warning=FALSE}

model_14 <- lm(formula = gmv ~ promotional_offer + Procurement_SLA + holiday_freq + 
                 Affiliates + 
                 SEM + inc_LP_MA1 + inc_PO_MA1 + 
                 promotional_offer.2 + 
                 NPS.3 + holiday_freq.2 + gmv.1
               , data = Dis_model)

summary(model_14)
```
```{r message=FALSE, warning=FALSE}
model_15 <- lm(formula = gmv ~ promotional_offer + holiday_freq + 
                 Affiliates + 
                 SEM + inc_LP_MA1 + inc_PO_MA1 + 
                 promotional_offer.2 + 
                 NPS.3 + holiday_freq.2 + gmv.1
               , data = Dis_model)

summary(model_15)
```
```{r message=FALSE, warning=FALSE}
model_16 <- lm(formula = gmv ~ promotional_offer + holiday_freq + 
                 SEM + inc_LP_MA1 + inc_PO_MA1 + 
                 promotional_offer.2 + 
                 NPS.3 + holiday_freq.2 + gmv.1
               , data = Dis_model)
summary(model_16)
```
```{r message=FALSE, warning=FALSE}

model_17 <- lm(formula = gmv ~ promotional_offer + holiday_freq + 
                 inc_LP_MA1 + inc_PO_MA1 + 
                 promotional_offer.2 + 
                 NPS.3 + holiday_freq.2 + gmv.1
               , data = Dis_model)
summary(model_17)

```
```{r message=FALSE, warning=FALSE}
model_18 <- lm(formula = gmv ~ promotional_offer + holiday_freq + 
                 inc_LP_MA1 + inc_PO_MA1 + 
                 promotional_offer.2 + 
                 NPS.3 + gmv.1
               , data = Dis_model)
summary(model_18)
```
```{r message=FALSE, warning=FALSE}
model_19 <- lm(formula = gmv ~ holiday_freq + 
                 inc_LP_MA1 + inc_PO_MA1 + 
                 promotional_offer.2 + 
                 NPS.3 + gmv.1
               , data = Dis_model)
summary(model_19)
```
```{r message=FALSE, warning=FALSE}
##Final Model 

Dist_Final_Model_game <- model_19

# Adj R square  = 0.5335 with 6 significant variables

temp_crossval <- cv.lm(data = Dis_model, form.lm = formula(gmv ~ holiday_freq + inc_LP_MA1 + inc_PO_MA1 + promotional_offer.2 + NPS.3 + gmv.1),m = 10)
Cross_game[4] <- attr(temp_crossval, "ms")

########################################################################################
```
```{r message=FALSE, warning=FALSE}
# Elasticity Analysis
train <- Dis_model

grlm <- Dist_Final_Model_game
```
```{r message=FALSE, warning=FALSE}

# estimating the elasticity coefficients

elasticity <- function(var){
  
  elax1 <-as.numeric(grlm$coefficients[var]*mean(train[,var])/mean(train$gmv))
  
  return(elax1)
} 

var_list <- list()

for(i in 2:length(grlm$coefficients)){
  
  var_list[i-1] <-elasticity(names(grlm$coefficients)[i])
  
}

elasticity.outputs <- data.frame(names(grlm$coefficients[2:length(grlm$coefficients)]))
elasticity.outputs <- cbind(elasticity.outputs,do.call(rbind.data.frame, var_list))
colnames(elasticity.outputs) <- c("Variable","Elasticity")

elasticity.outputs$direction <- ifelse(elasticity.outputs$Elasticity > 0, "Positive", "Negative")



ggplot(data=elasticity.outputs, aes(x=reorder(Variable,Elasticity),y=Elasticity)) +
  geom_bar(position="dodge",stat="identity") + 
  coord_flip() +
  ggtitle("Game Accessory - Distributed Lag Model") +xlab("Variables")


################################################################################
```
```{r message=FALSE, warning=FALSE}

# Multiplicative + distributed model: 

Multi_dist <- Game_final[-c(1:4,10:13,22:30,37:39)] # Not considered moving averages.

# gmv

Multi_Dis_model_1 <- slide(Multi_dist, Var = "gmv",slideBy = -1)

Multi_Dis_model_1 <- slide(Multi_Dis_model_1, Var = "gmv",slideBy = -2)

Multi_Dis_model_1 <- slide(Multi_Dis_model_1, Var = "gmv",slideBy = -3)

Multi_dist <- na.omit(Multi_Dis_model_1)



colnames(Multi_dist)[14:22]<- c("promotional_offer_1","promotional_offer_2","promotional_offer_3","NPS_1",
                                "NPS_2","NPS_3", "gmv_1", "gmv_2", "gmv_3")
Multi_dist$Content.Marketing[which(Multi_dist$Content.Marketing==0)] <-1
Multi_dist$per_order[which(Multi_dist$per_order==0)] <-0.01


########################################################

Multi_dist <- log(Multi_dist)

model_1 <- lm(gmv~., Multi_dist)

summary(model_1)

model_2 <- stepAIC(model_1,direction = "both")

summary(model_2) 

vif(model_2)

```
```{r message=FALSE, warning=FALSE}
model_3 <- lm(formula = gmv ~ SLA + promotional_offer + Procurement_SLA + 
                TV + Digital + Sponsorship + Content.Marketing + Online_marketing + 
                SEM + promotional_offer_1 + promotional_offer_2 + 
                NPS_2 + gmv_1 + gmv_2 + gmv_3, data = Multi_dist)

summary(model_3)

vif(model_3)
```
```{r message=FALSE, warning=FALSE}

model_4 <- lm(formula = gmv ~ SLA + promotional_offer + Procurement_SLA + 
                TV + Digital + Sponsorship + Content.Marketing + 
                SEM + promotional_offer_1 + promotional_offer_2 + 
                NPS_2 + gmv_1 + gmv_2 + gmv_3, data = Multi_dist)

summary(model_4)

vif(model_4)
```
```{r message=FALSE, warning=FALSE}

model_5 <- lm(formula = gmv ~ SLA + promotional_offer + Procurement_SLA + 
                TV + Digital + Sponsorship + Content.Marketing + 
                promotional_offer_1 + promotional_offer_2 + 
                NPS_2 + gmv_1 + gmv_2 + gmv_3, data = Multi_dist)

summary(model_5)

vif(model_5)

```
```{r message=FALSE, warning=FALSE}

model_6 <- lm(formula = gmv ~ SLA + promotional_offer + Procurement_SLA + 
                Digital + Sponsorship + Content.Marketing + 
                promotional_offer_1 + promotional_offer_2 + 
                NPS_2 + gmv_1 + gmv_2 + gmv_3, data = Multi_dist)

summary(model_6)

vif(model_6)
```
```{r message=FALSE, warning=FALSE}

model_7 <- lm(formula = gmv ~ SLA + promotional_offer + Procurement_SLA + 
                Digital + Sponsorship + Content.Marketing + 
                promotional_offer_1 + promotional_offer_2 + 
                NPS_2 + gmv_1 + gmv_3, data = Multi_dist)

summary(model_7)

vif(model_7)
```
```{r message=FALSE, warning=FALSE}

model_8 <- lm(formula = gmv ~ SLA + promotional_offer + Procurement_SLA + 
                Digital + Sponsorship + Content.Marketing + 
                promotional_offer_1 + promotional_offer_2 + 
                NPS_2 + gmv_1, data = Multi_dist)

summary(model_8)

vif(model_8)
```
```{r message=FALSE, warning=FALSE}

model_9 <- lm(formula = gmv ~ promotional_offer + Procurement_SLA + 
                Digital + Sponsorship + Content.Marketing + 
                promotional_offer_1 + promotional_offer_2 + 
                NPS_2 + gmv_1, data = Multi_dist)

summary(model_9)

vif(model_9)
```
```{r message=FALSE, warning=FALSE}
model_10 <- lm(formula = gmv ~ promotional_offer + Procurement_SLA + 
                 Digital + Sponsorship + Content.Marketing + 
                 promotional_offer_2 + 
                 NPS_2 + gmv_1, data = Multi_dist)
summary(model_10)
```
```{r message=FALSE, warning=FALSE}

model_11 <- lm(formula = gmv ~ Procurement_SLA + 
                 Digital + Sponsorship + Content.Marketing + 
                 promotional_offer_2 + 
                 NPS_2 + gmv_1, data = Multi_dist)
summary(model_11)

```
```{r message=FALSE, warning=FALSE}
model_12 <- lm(formula = gmv ~ Procurement_SLA + 
                 Digital + Sponsorship + 
                 promotional_offer_2 + 
                 NPS_2 + gmv_1, data = Multi_dist)

summary(model_12)
```
```{r message=FALSE, warning=FALSE}
model_13 <- lm(formula = gmv ~ Digital + Sponsorship + 
                 promotional_offer_2 + 
                 NPS_2 + gmv_1, data = Multi_dist)

summary(model_13)
```
```{r message=FALSE, warning=FALSE}
# Adjusted R-squared:  0.6379  with 5 significant variables

Multi_Dist_Final_Model_game <- model_13

temp_crossval <- cv.lm(data = Multi_dist, form.lm = formula(gmv ~ Digital + Sponsorship + promotional_offer_2 + NPS_2 + gmv_1),m = 10)
                                                              
Cross_game[5] <- attr(temp_crossval, "ms")
```
```{r message=FALSE, warning=FALSE}
######################################################################################
# Elasticity Analysis

train <- Multi_dist

grlm <- Multi_Dist_Final_Model_game
```
```{r message=FALSE, warning=FALSE}

# estimating the elasticity coefficients

elasticity <- function(var){
  
  elax1 <-as.numeric(grlm$coefficients[var]*mean(train[,var])/mean(train$gmv))
  
  return(elax1)
} 

var_list <- list()

for(i in 2:length(grlm$coefficients)){
  
  var_list[i-1] <-elasticity(names(grlm$coefficients)[i])
  
}

elasticity.outputs <- data.frame(names(grlm$coefficients[2:length(grlm$coefficients)]))
elasticity.outputs <- cbind(elasticity.outputs,do.call(rbind.data.frame, var_list))
colnames(elasticity.outputs) <- c("Variable","Elasticity")

elasticity.outputs$direction <- ifelse(elasticity.outputs$Elasticity > 0, "Positive", "Negative")



ggplot(data=elasticity.outputs, aes(x=reorder(Variable,Elasticity),y=Elasticity)) +
  geom_bar(position="dodge",stat="identity") + 
  coord_flip() +
  ggtitle("Game Accessory - Multi. & DL model") +xlab("Variables")

```
## Model on Home Audio Dataset
```{r message=FALSE, warning=FALSE}

Cross_home<- rep(0,5)

# Build the Basic Linear regression model

Linear_model <- Home_final

Linear_model <- Linear_model[,-c(1:4,10:12,28:39)]

Linear_model <- scale(Linear_model)

Linear_model <-data.frame(Linear_model)

model_1 <- lm(gmv~.,Linear_model)
```
```{r message=FALSE, warning=FALSE}

# Summary of Linear Model 
summary(model_1)


library(car)
library(MASS)

model_2 <- stepAIC(model_1,direction = "both")

summary(model_2) 

vif(model_2)
```
```{r message=FALSE, warning=FALSE}


model_3 <- lm(formula = gmv ~ Procurement_SLA + per_order + NPS + holiday_freq + 
                TV + Sponsorship + Content.Marketing + 
                Affiliates + SEM + inc_PO_MA1 + inc_PO_MA3, data = Linear_model)


summary(model_3) 

vif(model_3)
```
```{r message=FALSE, warning=FALSE}

model_4 <-  lm(formula = gmv ~ Procurement_SLA + per_order + NPS + holiday_freq + 
                 TV + Sponsorship + Content.Marketing + 
                 Affiliates + inc_PO_MA1 + inc_PO_MA3, data = Linear_model)


summary(model_4) 

vif(model_4)
```
```{r message=FALSE, warning=FALSE}


model_5 <- lm(formula = gmv ~ Procurement_SLA + per_order + NPS + holiday_freq + 
                TV + Sponsorship + Content.Marketing + 
                inc_PO_MA1 + inc_PO_MA3, data = Linear_model)


summary(model_5) 

vif(model_5)

```
```{r message=FALSE, warning=FALSE}

model_6 <- lm(formula = gmv ~ Procurement_SLA + per_order + holiday_freq + 
                TV + Sponsorship + Content.Marketing + 
                inc_PO_MA1 + inc_PO_MA3, data = Linear_model)


summary(model_6) 

vif(model_6)

```
```{r message=FALSE, warning=FALSE}

model_7 <- lm(formula = gmv ~ Procurement_SLA + per_order + holiday_freq + 
                TV + Sponsorship + Content.Marketing + 
                inc_PO_MA1, data = Linear_model)



summary(model_7)

vif(model_7)
```
```{r message=FALSE, warning=FALSE}

model_8 <- lm(formula = gmv ~ Procurement_SLA + per_order + holiday_freq + 
                TV + Sponsorship + 
                inc_PO_MA1, data = Linear_model)


summary(model_8)

vif(model_8)
```
```{r message=FALSE, warning=FALSE}

model_9 <- lm(formula = gmv ~ Procurement_SLA + per_order + holiday_freq + 
                Sponsorship + 
                inc_PO_MA1, data = Linear_model)

summary(model_9)
```
```{r message=FALSE, warning=FALSE}


model_10 <- lm(formula = gmv ~ per_order + holiday_freq + 
                 Sponsorship + 
                 inc_PO_MA1, data = Linear_model)


summary(model_10)
```
```{r message=FALSE, warning=FALSE}


model_11 <- lm(formula = gmv ~ holiday_freq + 
                 Sponsorship + 
                 inc_PO_MA1, data = Linear_model)


summary(model_11)

```
```{r message=FALSE, warning=FALSE}

model_12 <- lm(formula = gmv ~ holiday_freq + 
                 Sponsorship, data = Linear_model)


summary(model_12)

```
##Final Model 
```{r message=FALSE, warning=FALSE}

Linear_Final_model_home <- model_12

# Adj R square  = 0.3064  with 2 variables

temp_crossval <- cv.lm(data = Linear_model, form.lm = formula(gmv ~ holiday_freq + Sponsorship),m = 10)
                                                                
Cross_home[1] <- attr(temp_crossval, "ms")

##############################################################################

# Elasticity Analysis

train <- Linear_model


grlm <- Linear_Final_model_home


# estimating the elasticity coefficients

elasticity <- function(var){
  
  elax1 <-as.numeric(grlm$coefficients[var]*mean(train[,var])/mean(train$gmv))
  
  return(elax1)
} 

var_list <- list()

for(i in 2:length(grlm$coefficients)){
  
  var_list[i-1] <-elasticity(names(grlm$coefficients)[i])
  
}

elasticity.outputs <- data.frame(names(grlm$coefficients[2:length(grlm$coefficients)]))
elasticity.outputs <- cbind(elasticity.outputs,do.call(rbind.data.frame, var_list))
colnames(elasticity.outputs) <- c("Variable","Elasticity")

elasticity.outputs$direction <- ifelse(elasticity.outputs$Elasticity > 0, "Positive", "Negative")


ggplot(data=elasticity.outputs, aes(x=reorder(Variable,Elasticity),y=Elasticity)) +
  geom_bar(position="dodge",stat="identity") + 
  coord_flip() +
  ggtitle("Home Audio - Linear Model") +xlab("Variables")

```
## Multiplicative Model
```{r message=FALSE, warning=FALSE}

Home_multi <- Home_final
Home_multi <- Home_multi[,-c(1:4,10:12,13,22:39)]


# Treatment

Home_multi$Content.Marketing[which(Home_multi$Content.Marketing==0)] <- 0.01

Home_multi$per_order[which(Home_multi$per_order==0)] <- 0.01

Home_multi <- log(Home_multi)

################################################
#################################################

## Build the First model ##

multi_model <- lm(gmv~.,Home_multi)

summary(multi_model)

library(car)
library(MASS)

multi_model_2 <- stepAIC(multi_model,direction = "both")

summary(multi_model_2)

vif(multi_model_2)
```
```{r message=FALSE, warning=FALSE}

model_3 <- lm(formula = gmv ~ promotional_offer + NPS + TV + Digital + Online_marketing
              , data = Home_multi)



summary(model_3) 

vif(model_3)
```
```{r message=FALSE, warning=FALSE}


model_4 <- lm(formula = gmv ~ promotional_offer + NPS + Digital + Online_marketing
              , data = Home_multi)
summary(model_4)

vif(model_4)

```
```{r message=FALSE, warning=FALSE}
model_5 <- lm(formula = gmv ~ promotional_offer + Digital + Online_marketing
              , data = Home_multi)

summary(model_5)

vif(model_5)
```
```{r message=FALSE, warning=FALSE}

model_6 <- lm(formula = gmv ~ promotional_offer + Digital
              , data = Home_multi)

summary(model_6)

vif(model_6)
```
```{r message=FALSE, warning=FALSE}

### 
# Multiplicative : Final Model Model-6

multi_final_model_home <- model_6

#Adj R2 = 0.2593   with 2 significant variables 

temp_crossval <- cv.lm(data = Home_multi, form.lm = formula(gmv ~ promotional_offer + Digital),m = 10)
Cross_home[2] <- attr(temp_crossval, "ms")

###################################################################################
# Elasticity Analysis

train <- Home_multi


grlm <- multi_final_model_home


# estimating the elasticity coefficients

elasticity <- function(var){
  
  elax1 <-as.numeric(grlm$coefficients[var]*mean(train[,var])/mean(train$gmv))
  
  return(elax1)
} 

var_list <- list()

for(i in 2:length(grlm$coefficients)){
  
  var_list[i-1] <-elasticity(names(grlm$coefficients)[i])
  
}

elasticity.outputs <- data.frame(names(grlm$coefficients[2:length(grlm$coefficients)]))
elasticity.outputs <- cbind(elasticity.outputs,do.call(rbind.data.frame, var_list))
colnames(elasticity.outputs) <- c("Variable","Elasticity")

elasticity.outputs$direction <- ifelse(elasticity.outputs$Elasticity > 0, "Positive", "Negative")


ggplot(data=elasticity.outputs, aes(x=reorder(Variable,Elasticity),y=Elasticity)) +
  geom_bar(position="dodge",stat="identity") + 
  coord_flip() +
  ggtitle("Home Audio - Multiplicative Model") +xlab("Variables")




#######################################################################################################################
#######################################################################################################################
############################################## Koyck models #################################################

Home_koyck<- Home_final[,-c(1:4,10:12,28:39)]


# gmv 1 lag
Home_koyck <- slide(Home_koyck, Var = "gmv",slideBy = -1)


Home_koyck <- na.omit(Home_koyck)

Home_koyck <- scale(Home_koyck)

Home_koyck <- data.frame(Home_koyck)

# Build first model
Koy_model <- lm(gmv~.,Home_koyck)

summary(Koy_model)

model_2 <- stepAIC(Koy_model,direction = "both")

summary(model_2)  
vif(model_2)
```
```{r message=FALSE, warning=FALSE}
model_3 <- lm(formula = gmv ~ Procurement_SLA + per_order + NPS + holiday_freq + 
                TV + Digital + Sponsorship + Content.Marketing + 
                Affiliates + inc_PO_MA1 + inc_PO_MA3, data = Home_koyck)


summary(model_3)

vif(model_3)
```
```{r message=FALSE, warning=FALSE}

model_4 <- lm(formula = gmv ~ Procurement_SLA + per_order + NPS + holiday_freq + 
                TV + Digital + Sponsorship + 
                Affiliates + inc_PO_MA1 + inc_PO_MA3, data = Home_koyck)


summary(model_4)

vif(model_4)
```
```{r message=FALSE, warning=FALSE}

model_5 <- lm(formula = gmv ~ Procurement_SLA + per_order + holiday_freq + 
                TV + Digital + Sponsorship + 
                Affiliates + inc_PO_MA1 + inc_PO_MA3, data = Home_koyck)

summary(model_5)

vif(model_5)

```
```{r message=FALSE, warning=FALSE}
model_6 <- lm(formula = gmv ~ Procurement_SLA + per_order + holiday_freq + 
                TV + Digital + Sponsorship + 
                Affiliates + inc_PO_MA3, data = Home_koyck)


summary(model_6)

vif(model_6)
```
```{r message=FALSE, warning=FALSE}

model_7 <- lm(formula = gmv ~ Procurement_SLA + per_order + holiday_freq + 
                TV + Digital + 
                Affiliates + inc_PO_MA3, data = Home_koyck)

summary(model_7)

vif(model_7)

```
```{r message=FALSE, warning=FALSE}
model_8 <- lm(formula = gmv ~ Procurement_SLA + per_order + holiday_freq + 
                TV + Digital + 
                inc_PO_MA3, data = Home_koyck)

summary(model_8)

vif(model_8)

```
```{r message=FALSE, warning=FALSE}
model_9 <- lm(formula = gmv ~ per_order + holiday_freq + 
                TV + Digital + 
                inc_PO_MA3, data = Home_koyck)

summary(model_9)

vif(model_9)

```
```{r message=FALSE, warning=FALSE}
model_10 <- lm(formula = gmv ~ per_order + 
                 TV + Digital + 
                 inc_PO_MA3, data = Home_koyck)


summary(model_10)
```
```{r message=FALSE, warning=FALSE}

model_11 <- lm(formula = gmv ~ TV + Digital + 
                 inc_PO_MA3, data = Home_koyck)

summary(model_11)

```
```{r message=FALSE, warning=FALSE}
model_12 <- lm(formula = gmv ~ Digital + 
                 inc_PO_MA3, data = Home_koyck)

summary(model_12)
```
```{r message=FALSE, warning=FALSE}

##Final Model 
koyck_Final_Model_home <- model_12 

# Adj R square  = 0.3118 with 2 significant variable 

temp_crossval <- cv.lm(data = Home_koyck, form.lm = formula(gmv ~ Digital + inc_PO_MA3),m = 10)
                                                              
Cross_home[3] <- attr(temp_crossval, "ms")


```
## Elasticity Analysis
```{r message=FALSE, warning=FALSE}

train <- Home_koyck


grlm <- koyck_Final_Model_home

```
## estimating the elasticity coefficients
```{r message=FALSE, warning=FALSE}
elasticity <- function(var){
  
  elax1 <-as.numeric(grlm$coefficients[var]*mean(train[,var])/mean(train$gmv))
  
  return(elax1)
} 

var_list <- list()

for(i in 2:length(grlm$coefficients)){
  
  var_list[i-1] <-elasticity(names(grlm$coefficients)[i])
  
}

elasticity.outputs <- data.frame(names(grlm$coefficients[2:length(grlm$coefficients)]))
elasticity.outputs <- cbind(elasticity.outputs,do.call(rbind.data.frame, var_list))
colnames(elasticity.outputs) <- c("Variable","Elasticity")

elasticity.outputs$direction <- ifelse(elasticity.outputs$Elasticity > 0, "Positive", "Negative")


ggplot(data=elasticity.outputs, aes(x=reorder(Variable,Elasticity),y=Elasticity)) +
  geom_bar(position="dodge",stat="identity") + 
  coord_flip() +
  ggtitle("Home Audio - Koyck Model") +xlab("Variables")

```
## Distributed lag models
```{r message=FALSE, warning=FALSE}

Dis_Model <- Home_final[,-c(1:4,10:12, 28:30)]

Dis_model_1 <- slide(Dis_Model, Var = "gmv",slideBy = -1)

Dis_model_1 <- slide(Dis_model_1, Var = "gmv",slideBy = -2)

Dis_model_1 <- slide(Dis_model_1, Var = "gmv",slideBy = -3)

Dis_model <- na.omit(Dis_model_1)

Dis_model <- scale(Dis_model)
Dis_model <- data.frame(Dis_model)

```
## Lag distribution model: 
```{r message=FALSE, warning=FALSE}

dist_model <- lm(gmv~.,Dis_model)

summary(dist_model)


model_2 <- stepAIC(dist_model,direction = "both")

summary(model_2)

vif(model_2)

```
```{r message=FALSE, warning=FALSE}

model_3 <- lm(formula = gmv ~ SLA + promotional_offer + Procurement_SLA + 
                per_order + NPS + holiday_freq + TV + Digital + Sponsorship + 
                Content.Marketing + Online_marketing + Affiliates + inc_LP_MA2 + 
                inc_LP_MA3 + inc_PO_MA2 + promotional_offer.1 + 
                promotional_offer.2 + promotional_offer.3 + NPS.1 + NPS.3 + 
                holiday_freq.2 + holiday_freq.3 + gmv.3, data = Dis_model)

summary(model_3)


vif(model_3)

```
```{r message=FALSE, warning=FALSE}


model_4 <- lm(formula = gmv ~ SLA + promotional_offer + Procurement_SLA + 
                per_order + NPS + holiday_freq + TV + Digital + Sponsorship + 
                Content.Marketing + Online_marketing + Affiliates + inc_LP_MA2 + 
                inc_LP_MA3 + promotional_offer.1 + 
                promotional_offer.2 + promotional_offer.3 + NPS.1 + NPS.3 + 
                holiday_freq.2 + holiday_freq.3 + gmv.3, data = Dis_model)


summary(model_4)


vif(model_4)
```
```{r message=FALSE, warning=FALSE}


model_5 <- lm(formula = gmv ~ SLA + promotional_offer + Procurement_SLA + 
                per_order + NPS + holiday_freq + TV + Digital + Sponsorship + 
                Content.Marketing + Online_marketing + inc_LP_MA2 + 
                inc_LP_MA3 + promotional_offer.1 + 
                promotional_offer.2 + promotional_offer.3 + NPS.1 + NPS.3 + 
                holiday_freq.2 + holiday_freq.3 + gmv.3, data = Dis_model)

summary(model_5)


vif(model_5)
```
```{r message=FALSE, warning=FALSE}


model_6 <- lm(formula = gmv ~ SLA + promotional_offer + Procurement_SLA + 
                per_order + NPS + holiday_freq + TV + Digital + Sponsorship + 
                Content.Marketing + Online_marketing + inc_LP_MA2 + 
                promotional_offer.1 + 
                promotional_offer.2 + promotional_offer.3 + NPS.1 + NPS.3 + 
                holiday_freq.2 + holiday_freq.3 + gmv.3, data = Dis_model)


summary(model_6)


vif(model_6)

```
```{r message=FALSE, warning=FALSE}

model_7 <- lm(formula = gmv ~ SLA + promotional_offer + Procurement_SLA + 
                per_order + NPS + holiday_freq + TV + Digital + Sponsorship + 
                Online_marketing + inc_LP_MA2 + 
                promotional_offer.1 + 
                promotional_offer.2 + promotional_offer.3 + NPS.1 + NPS.3 + 
                holiday_freq.2 + holiday_freq.3 + gmv.3, data = Dis_model)

summary(model_7)


vif(model_7)

```
```{r message=FALSE, warning=FALSE}

model_8 <- lm(formula = gmv ~ SLA + promotional_offer + Procurement_SLA + 
                per_order + NPS + holiday_freq + TV + Digital + Sponsorship + 
                Online_marketing + inc_LP_MA2 + 
                promotional_offer.1 + 
                promotional_offer.2 + promotional_offer.3 + NPS.3 + 
                holiday_freq.2 + holiday_freq.3 + gmv.3, data = Dis_model)
summary(model_8)

vif(model_8)

```
```{r message=FALSE, warning=FALSE}


model_9 <- lm(formula = gmv ~ SLA + promotional_offer + Procurement_SLA + 
                per_order + holiday_freq + TV + Digital + Sponsorship + 
                Online_marketing + inc_LP_MA2 + 
                promotional_offer.1 + 
                promotional_offer.2 + promotional_offer.3 + NPS.3 + 
                holiday_freq.2 + holiday_freq.3 + gmv.3, data = Dis_model)

summary(model_9)

vif(model_9)

```
```{r message=FALSE, warning=FALSE}

model_10 <- lm(formula = gmv ~ SLA + promotional_offer + Procurement_SLA + 
                 per_order + holiday_freq + TV + Sponsorship + 
                 Online_marketing + inc_LP_MA2 + 
                 promotional_offer.1 + 
                 promotional_offer.2 + promotional_offer.3 + NPS.3 + 
                 holiday_freq.2 + holiday_freq.3 + gmv.3, data = Dis_model)


summary(model_10)
vif(model_10)
```
```{r message=FALSE, warning=FALSE}


model_11 <- model_10 <- lm(formula = gmv ~ SLA + promotional_offer + Procurement_SLA + 
                             per_order + holiday_freq + TV + Sponsorship + 
                             inc_LP_MA2 + 
                             promotional_offer.1 + 
                             promotional_offer.2 + promotional_offer.3 + NPS.3 + 
                             holiday_freq.2 + holiday_freq.3 + gmv.3, data = Dis_model)

summary(model_11)

vif(model_11)

```
```{r message=FALSE, warning=FALSE}


model_12 <- lm(formula = gmv ~ promotional_offer + Procurement_SLA + 
                 per_order + holiday_freq + TV + Sponsorship + 
                 inc_LP_MA2 + 
                 promotional_offer.1 + 
                 promotional_offer.2 + promotional_offer.3 + NPS.3 + 
                 holiday_freq.2 + holiday_freq.3 + gmv.3, data = Dis_model)

summary(model_12)

vif(model_12)

```
```{r message=FALSE, warning=FALSE}

model_13 <- lm(formula = gmv ~ promotional_offer + Procurement_SLA + 
                 per_order + holiday_freq + TV + Sponsorship + 
                 inc_LP_MA2 + 
                 promotional_offer.1 + 
                 promotional_offer.3 + NPS.3 + 
                 holiday_freq.2 + holiday_freq.3 + gmv.3, data = Dis_model)

summary(model_13)

vif(model_13)
```
```{r message=FALSE, warning=FALSE}


model_14 <- lm(formula = gmv ~ promotional_offer + Procurement_SLA + 
                 per_order + TV + Sponsorship + 
                 inc_LP_MA2 + 
                 promotional_offer.1 + 
                 promotional_offer.3 + NPS.3 + 
                 holiday_freq.2 + holiday_freq.3 + gmv.3, data = Dis_model)

summary(model_14)

vif(model_14)

```
```{r message=FALSE, warning=FALSE}

model_15 <- lm(formula = gmv ~ promotional_offer + Procurement_SLA + 
                 TV + Sponsorship + 
                 inc_LP_MA2 + 
                 promotional_offer.1 + 
                 promotional_offer.3 + NPS.3 + 
                 holiday_freq.2 + holiday_freq.3 + gmv.3, data = Dis_model)

summary(model_15)

```
```{r message=FALSE, warning=FALSE}

model_16 <- lm(formula = gmv ~ promotional_offer + Procurement_SLA + 
                 TV + Sponsorship + 
                 inc_LP_MA2 + 
                 promotional_offer.1 + 
                 promotional_offer.3 + 
                 holiday_freq.2 + holiday_freq.3 + gmv.3, data = Dis_model)

summary(model_16)
```
```{r message=FALSE, warning=FALSE}


model_17 <- lm(formula = gmv ~ promotional_offer + 
                 TV + Sponsorship + 
                 inc_LP_MA2 + 
                 promotional_offer.1 + 
                 promotional_offer.3 + 
                 holiday_freq.2 + holiday_freq.3 + gmv.3, data = Dis_model)
summary(model_17)
```
```{r message=FALSE, warning=FALSE}


model_18 <- lm(formula = gmv ~ promotional_offer + 
                 Sponsorship + 
                 inc_LP_MA2 + 
                 promotional_offer.1 + 
                 promotional_offer.3 + 
                 holiday_freq.2 + holiday_freq.3 + gmv.3, data = Dis_model)
summary(model_18)

```
```{r message=FALSE, warning=FALSE}

model_19 <- lm(formula = gmv ~ promotional_offer + 
                 Sponsorship + 
                 inc_LP_MA2 + 
                 promotional_offer.1 + 
                 promotional_offer.3 + 
                 holiday_freq.2 + gmv.3, data = Dis_model)
summary(model_19)

```
```{r message=FALSE, warning=FALSE}

model_20 <- lm(formula = gmv ~ promotional_offer + 
                 Sponsorship + 
                 inc_LP_MA2 + 
                 promotional_offer.3 + 
                 holiday_freq.2 + gmv.3, data = Dis_model)
summary(model_20)

```
```{r message=FALSE, warning=FALSE}

model_21 <- lm(formula = gmv ~ promotional_offer + 
                 Sponsorship +
                 promotional_offer.3 + 
                 holiday_freq.2 + gmv.3, data = Dis_model)
summary(model_21)

```
```{r message=FALSE, warning=FALSE}

model_22 <- lm(formula = gmv ~ promotional_offer + 
                 Sponsorship +
                 holiday_freq.2 + gmv.3, data = Dis_model)
summary(model_22)

```
```{r message=FALSE, warning=FALSE}

model_23 <- lm(formula = gmv ~ promotional_offer + 
                 Sponsorship +
                 holiday_freq.2, data = Dis_model)
summary(model_23)

```
```{r message=FALSE, warning=FALSE}

model_24 <- lm(formula = gmv ~ promotional_offer + 
                 Sponsorship
               , data = Dis_model)
summary(model_24)

```
##Final Model 
```{r message=FALSE, warning=FALSE}

Dist_Final_Model_home <- model_24

# Adj R square  = 0.4291 with 2 significant variables

temp_crossval <- cv.lm(data = Dis_model, form.lm = formula(gmv ~ promotional_offer + Sponsorship),m = 10)
                                                             
Cross_home[4] <- attr(temp_crossval, "ms")

```
```{r message=FALSE, warning=FALSE}

# Elasticity Analysis

train <- Dis_model


grlm <- Dist_Final_Model_home

```
## estimating the elasticity coefficients
```{r message=FALSE, warning=FALSE}

elasticity <- function(var){
  
  elax1 <-as.numeric(grlm$coefficients[var]*mean(train[,var])/mean(train$gmv))
  
  return(elax1)
} 

var_list <- list()

for(i in 2:length(grlm$coefficients)){
  
  var_list[i-1] <-elasticity(names(grlm$coefficients)[i])
  
}

elasticity.outputs <- data.frame(names(grlm$coefficients[2:length(grlm$coefficients)]))
elasticity.outputs <- cbind(elasticity.outputs,do.call(rbind.data.frame, var_list))
colnames(elasticity.outputs) <- c("Variable","Elasticity")

elasticity.outputs$direction <- ifelse(elasticity.outputs$Elasticity > 0, "Positive", "Negative")


ggplot(data=elasticity.outputs, aes(x=reorder(Variable,Elasticity),y=Elasticity)) +
  geom_bar(position="dodge",stat="identity") + 
  coord_flip() +
  ggtitle("Home Audio - Distributed Lag Model") +xlab("Variables")

```
## Multiplicative + distributed model: 
```{r message=FALSE, warning=FALSE}


Multi_dist <- Home_final[-c(1:4,10:13,22:30,37:39)] # Not considered moving averages.

# gmv

Multi_Dis_model_1 <- slide(Multi_dist, Var = "gmv",slideBy = -1)

Multi_Dis_model_1 <- slide(Multi_Dis_model_1, Var = "gmv",slideBy = -2)

Multi_Dis_model_1 <- slide(Multi_Dis_model_1, Var = "gmv",slideBy = -3)

Multi_dist <- na.omit(Multi_Dis_model_1)


colnames(Multi_dist)[14:22]<- c("promotional_offer_1","promotional_offer_2","promotional_offer_3","NPS_1",
                                "NPS_2","NPS_3", "gmv_1", "gmv_2", "gmv_3")


Multi_dist$Content.Marketing[which(Multi_dist$Content.Marketing==0)] <-1
Multi_dist$per_order[which(Multi_dist$per_order==0)] <-0.01

```
```{r message=FALSE, warning=FALSE}


Multi_dist <- log(Multi_dist)

model_1 <- lm(gmv~., Multi_dist)

summary(model_1)

model_2 <- stepAIC(model_1,direction = "both")

summary(model_2) 

vif(model_2)

```
```{r message=FALSE, warning=FALSE}

model_3 <- lm(formula = gmv ~ SLA + promotional_offer + NPS + TV + 
                Affiliates + NPS_1 + Content.Marketing, data = Multi_dist)

summary(model_3)

vif(model_3)
```
```{r message=FALSE, warning=FALSE}


model_4 <- lm(formula = gmv ~ SLA + promotional_offer + TV + 
                Affiliates + NPS_1 + Content.Marketing, data = Multi_dist)

summary(model_4)

vif(model_4)

```
```{r message=FALSE, warning=FALSE}

model_5 <- lm(formula = gmv ~ SLA + promotional_offer + TV + 
                NPS_1 + Content.Marketing, data = Multi_dist)

summary(model_5)

vif(model_5)

```
```{r message=FALSE, warning=FALSE}


model_6 <- lm(formula = gmv ~ SLA + promotional_offer + 
                NPS_1 + Content.Marketing, data = Multi_dist)

summary(model_6)

vif(model_6)

```
```{r message=FALSE, warning=FALSE}

model_7 <- lm(formula = gmv ~ SLA + promotional_offer + 
                NPS_1, data = Multi_dist)

summary(model_7)

vif(model_7)
```
```{r message=FALSE, warning=FALSE}


model_8 <- lm(formula = gmv ~ promotional_offer + 
                NPS_1, data = Multi_dist)

summary(model_8)

vif(model_8)
```
### Adjusted R-squared:  0.2492  with 2 significant variables
```{r message=FALSE, warning=FALSE}

Multi_Dist_Final_Model_home <- model_8

temp_crossval <- cv.lm(data = Multi_dist, form.lm = formula(gmv ~ promotional_offer + NPS_1),m = 10)
                                                              
Cross_home[5] <- attr(temp_crossval, "ms")

```
## Elasticity Analysis
```{r message=FALSE, warning=FALSE}
train <- Multi_dist


grlm <- Multi_Dist_Final_Model_home
```
```{r message=FALSE, warning=FALSE}


# estimating the elasticity coefficients

elasticity <- function(var){
  
  elax1 <-as.numeric(grlm$coefficients[var]*mean(train[,var])/mean(train$gmv))
  
  return(elax1)
} 

var_list <- list()

for(i in 2:length(grlm$coefficients)){
  
  var_list[i-1] <-elasticity(names(grlm$coefficients)[i])
  
}

elasticity.outputs <- data.frame(names(grlm$coefficients[2:length(grlm$coefficients)]))
elasticity.outputs <- cbind(elasticity.outputs,do.call(rbind.data.frame, var_list))
colnames(elasticity.outputs) <- c("Variable","Elasticity")

elasticity.outputs$direction <- ifelse(elasticity.outputs$Elasticity > 0, "Positive", "Negative")


ggplot(data=elasticity.outputs, aes(x=reorder(Variable,Elasticity),y=Elasticity)) +
  geom_bar(position="dodge",stat="identity") + 
  coord_flip() +
  ggtitle("Home Audio - Multi. & DL Model") +xlab("Variables")



```